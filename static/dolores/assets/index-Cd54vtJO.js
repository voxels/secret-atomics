(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const q="modulepreload",N=function(h){return"/dolores/"+h},j={},F=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let f=function(g){return Promise.all(g.map(x=>Promise.resolve(x).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};var d=f;document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=c?.nonce||c?.getAttribute("nonce");s=f(t.map(g=>{if(g=N(g),g in j)return;j[g]=!0;const x=g.endsWith(".css"),w=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${w}`))return;const b=document.createElement("link");if(b.rel=x?"stylesheet":q,x||(b.as="script"),b.crossOrigin="",b.href=g,u&&b.setAttribute("nonce",u),document.head.appendChild(b),x)return new Promise((E,C)=>{b.addEventListener("load",E),b.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${g}`)))})}))}function i(c){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=c,window.dispatchEvent(u),!u.defaultPrevented)throw c}return s.then(c=>{for(const u of c||[])u.status==="rejected"&&i(u.reason);return e().catch(i)})};function M(){throw new Error("Buffer is not included.")}M.isBuffer=function(){return!1};var Q=50;const U=Object.freeze(Object.defineProperty({__proto__:null,Buffer:M,INSPECT_MAX_BYTES:Q,SlowBuffer:M},Symbol.toStringTag,{value:"Module"})),H={};function k(){}function G(){for(var h=arguments.length,e=new Array(h),t=0;t<h;t++)e[t]=arguments[t];var n=e[0];e.shift(),setTimeout(function(){typeof n=="function"&&n.apply(null,e)},0)}function V(h){throw new Error("No such module. (Possibly not yet loaded)")}var W={},O="browser",K=1,Y=!0,J={},X=[],$="/";function Z(){return $}function ee(h){$=H.resolve(h,$)}const te=Object.freeze(Object.defineProperty({__proto__:null,arch:O,argv:X,binding:V,browser:Y,chdir:ee,cwd:Z,dlopen:k,env:J,execPath:O,exit:k,features:W,kill:k,memoryUsage:k,nextTick:G,pid:K,platform:O,title:O,umask:k,uptime:k,uvCounters:k},Symbol.toStringTag,{value:"Module"}));globalThis.Buffer=M||void 0||U;globalThis.process=te;class ne{products=new Map;constructor(e=[]){e.forEach(t=>this.products.set(t.id,t))}getProducts(){return Array.from(this.products.values())}getProduct(e){return this.products.get(e)}purchase(e){const t=this.products.get(e);return t?t.sold_out||t.stock<=0?{success:!1,reason:"Sold out"}:(t.stock-=1,t.stock===0&&(t.sold_out=!0),{success:!0}):{success:!1,reason:"Product not found"}}updateStock(e,t){const n=this.products.get(e);n&&(n.stock=t,n.sold_out=t<=0)}}var R={exports:{}},D;function ie(){if(D)return R.exports;D=1;var h=typeof Reflect=="object"?Reflect:null,e=h&&typeof h.apply=="function"?h.apply:function(o,a,l){return Function.prototype.apply.call(o,a,l)},t;h&&typeof h.ownKeys=="function"?t=h.ownKeys:Object.getOwnPropertySymbols?t=function(o){return Object.getOwnPropertyNames(o).concat(Object.getOwnPropertySymbols(o))}:t=function(o){return Object.getOwnPropertyNames(o)};function n(r){console&&console.warn&&console.warn(r)}var s=Number.isNaN||function(o){return o!==o};function i(){i.init.call(this)}R.exports=i,R.exports.once=v,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var d=10;function c(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(r){if(typeof r!="number"||r<0||s(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");d=r}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(o){if(typeof o!="number"||o<0||s(o))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+o+".");return this._maxListeners=o,this};function u(r){return r._maxListeners===void 0?i.defaultMaxListeners:r._maxListeners}i.prototype.getMaxListeners=function(){return u(this)},i.prototype.emit=function(o){for(var a=[],l=1;l<arguments.length;l++)a.push(arguments[l]);var p=o==="error",y=this._events;if(y!==void 0)p=p&&y.error===void 0;else if(!p)return!1;if(p){var m;if(a.length>0&&(m=a[0]),m instanceof Error)throw m;var _=new Error("Unhandled error."+(m?" ("+m.message+")":""));throw _.context=m,_}var I=y[o];if(I===void 0)return!1;if(typeof I=="function")e(I,this,a);else for(var B=I.length,z=E(I,B),l=0;l<B;++l)e(z[l],this,a);return!0};function f(r,o,a,l){var p,y,m;if(c(a),y=r._events,y===void 0?(y=r._events=Object.create(null),r._eventsCount=0):(y.newListener!==void 0&&(r.emit("newListener",o,a.listener?a.listener:a),y=r._events),m=y[o]),m===void 0)m=y[o]=a,++r._eventsCount;else if(typeof m=="function"?m=y[o]=l?[a,m]:[m,a]:l?m.unshift(a):m.push(a),p=u(r),p>0&&m.length>p&&!m.warned){m.warned=!0;var _=new Error("Possible EventEmitter memory leak detected. "+m.length+" "+String(o)+" listeners added. Use emitter.setMaxListeners() to increase limit");_.name="MaxListenersExceededWarning",_.emitter=r,_.type=o,_.count=m.length,n(_)}return r}i.prototype.addListener=function(o,a){return f(this,o,a,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(o,a){return f(this,o,a,!0)};function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function x(r,o,a){var l={fired:!1,wrapFn:void 0,target:r,type:o,listener:a},p=g.bind(l);return p.listener=a,l.wrapFn=p,p}i.prototype.once=function(o,a){return c(a),this.on(o,x(this,o,a)),this},i.prototype.prependOnceListener=function(o,a){return c(a),this.prependListener(o,x(this,o,a)),this},i.prototype.removeListener=function(o,a){var l,p,y,m,_;if(c(a),p=this._events,p===void 0)return this;if(l=p[o],l===void 0)return this;if(l===a||l.listener===a)--this._eventsCount===0?this._events=Object.create(null):(delete p[o],p.removeListener&&this.emit("removeListener",o,l.listener||a));else if(typeof l!="function"){for(y=-1,m=l.length-1;m>=0;m--)if(l[m]===a||l[m].listener===a){_=l[m].listener,y=m;break}if(y<0)return this;y===0?l.shift():C(l,y),l.length===1&&(p[o]=l[0]),p.removeListener!==void 0&&this.emit("removeListener",o,_||a)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(o){var a,l,p;if(l=this._events,l===void 0)return this;if(l.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):l[o]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete l[o]),this;if(arguments.length===0){var y=Object.keys(l),m;for(p=0;p<y.length;++p)m=y[p],m!=="removeListener"&&this.removeAllListeners(m);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(a=l[o],typeof a=="function")this.removeListener(o,a);else if(a!==void 0)for(p=a.length-1;p>=0;p--)this.removeListener(o,a[p]);return this};function w(r,o,a){var l=r._events;if(l===void 0)return[];var p=l[o];return p===void 0?[]:typeof p=="function"?a?[p.listener||p]:[p]:a?P(p):E(p,p.length)}i.prototype.listeners=function(o){return w(this,o,!0)},i.prototype.rawListeners=function(o){return w(this,o,!1)},i.listenerCount=function(r,o){return typeof r.listenerCount=="function"?r.listenerCount(o):b.call(r,o)},i.prototype.listenerCount=b;function b(r){var o=this._events;if(o!==void 0){var a=o[r];if(typeof a=="function")return 1;if(a!==void 0)return a.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function E(r,o){for(var a=new Array(o),l=0;l<o;++l)a[l]=r[l];return a}function C(r,o){for(;o+1<r.length;o++)r[o]=r[o+1];r.pop()}function P(r){for(var o=new Array(r.length),a=0;a<o.length;++a)o[a]=r[a].listener||r[a];return o}function v(r,o){return new Promise(function(a,l){function p(m){r.removeListener(o,y),l(m)}function y(){typeof r.removeListener=="function"&&r.removeListener("error",p),a([].slice.call(arguments))}S(r,o,y,{once:!0}),o!=="error"&&T(r,p,{once:!0})})}function T(r,o,a){typeof r.on=="function"&&S(r,"error",o,a)}function S(r,o,a,l){if(typeof r.on=="function")l.once?r.once(o,a):r.on(o,a);else if(typeof r.addEventListener=="function")r.addEventListener(o,function p(y){l.once&&r.removeEventListener(o,p),a(y)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}return R.exports}var oe=ie();class se{emitter;channelHandlers=new Map;constructor(){this.emitter=new oe.EventEmitter}subscribe(e,t){this.channelHandlers.has(e)||this.channelHandlers.set(e,new Set),this.channelHandlers.get(e).add(t),this.emitter.on(e,t),console.log(`[RealtimeMock] Subscribed to ${e}`)}publish(e,t){const n=Math.floor(Math.random()*50);setTimeout(()=>{this.emitter.emit(e,t),console.log(`[RealtimeMock] Published to ${e} with ${n}ms latency`,t)},n)}unsubscribe(e,t){const n=this.channelHandlers.get(e);n&&(n.delete(t),this.emitter.off(e,t))}send(e,t){return this.publish(e,t)}connect(){return console.log("[RealtimeMock] Connected (Simulated)"),this}}const re=[{id:"gold_100",name:"100 Reddit Gold",price_gold:100,stock:999,sold_out:!1},{id:"gold_500",name:"500 Reddit Gold",price_gold:450,stock:100,sold_out:!1},{id:"custom_avatar_rare",name:"Ultra Rare Avatar",price_gold:500,stock:5,sold_out:!1}],ae={Timers:{cooldownMs:5e3,respawnMs:3e3},Limits:{maxDailyPixels:100,maxStackSize:5}},ce={Animations:{placePixelDuration:300,overlayFadeIn:150,easing:"cubic-bezier(0.4, 0, 0.2, 1)"},Colors:{primary:"#FF4500",secondary:"#0079D3",error:"#FF0000",success:"#00BA7C",canvasBackground:"#FFFFFF"}},de={Onboarding:{welcomeTitle:"Welcome to Pixel Placer",welcomeBody:"Place pixels and create art together!"},Errors:{cooldown:"You are doing that too much. Take a break!",soldOut:"Sorry, we are all out of pixels."},Buttons:{place:"Place Pixel",buy:"Get More"}},le={Gameplay:ae,Visuals:ce,Copy:de};class ue{userId;subredditId;bucketId;reddit;redis;realtime;kv;media;ui;config;_state;economy;constructor(e={}){this.userId=e.userId||"t2_user123",this.subredditId=e.subredditId||"t5_sub456",this.bucketId=e.bucketId||(Math.random()>.5?"treatment":"control"),this.config=le,this.economy=new ne(e.initialProducts||re),this.reddit=this._mockReddit(),this.redis=this._mockRedis(),this.realtime=new se,this.kv=this._mockKV(),this.media=this._mockMedia(),this._state=new Map,this.ui=this._mockUI()}getBucket(){return this.bucketId}useState(e){const t=JSON.stringify(e);return this._state.has(t)||this._state.set(t,e),[this._state.get(t),n=>{const s=this._state.get(t),i=typeof n=="function"?n(s):n;this._state.set(t,i)}]}_mockReddit(){return{getCurrentUser:async()=>({id:this.userId,name:"dummy_user"}),getSubredditById:async e=>({id:e,name:"test_sub"}),getCurrentSubreddit:async()=>({id:this.subredditId,name:"test_sub"}),getProducts:async()=>this.economy.getProducts(),pay:async e=>{const t=this.economy.getProduct(e.productId),n=this.economy.purchase(e.productId);return console.log(`[MockEconomy] Triggering Modal for ${t?.name||e.productId}`),n.success?{status:"success"}:{status:"failed",reason:n.reason}}}}_mockRedis(){const e=new Map,t=typeof process<"u"&&process.versions!=null&&process.versions.node!=null,n=".dolores_redis_dump.json",s="dolores_redis_dump";if(t)try{const d=require("fs");if(d.existsSync(n)){const c=JSON.parse(d.readFileSync(n,"utf-8"));Object.entries(c).forEach(([u,f])=>e.set(u,f)),console.log("[MockRedis] Loaded persistent state from disk.")}}catch(d){console.warn("[MockRedis] Failed to load persistent state:",d)}else if(typeof localStorage<"u")try{const d=localStorage.getItem(s);if(d){const c=JSON.parse(d);Object.entries(c).forEach(([u,f])=>e.set(u,f)),console.log("[MockRedis] Loaded persistent state from localStorage.")}}catch(d){console.warn("[MockRedis] Failed to load localStorage:",d)}const i=()=>{const d=Object.fromEntries(e),c=JSON.stringify(d,null,2);if(t)try{require("fs").writeFileSync(n,c)}catch(u){console.error("[MockRedis] Persistence failed:",u)}else typeof localStorage<"u"&&localStorage.setItem(s,c)};return{get:async d=>e.get(d),set:async(d,c)=>{e.set(d,c),i()},del:async d=>{e.delete(d),i()},hGet:async(d,c)=>(e.get(d)||{})[c],hSet:async(d,c,u)=>{const f=e.get(d)||{};f[c]=u,e.set(d,f),i()}}}_mockKV(){const e=new Map;return{get:async t=>e.get(t),put:async(t,n)=>{e.set(t,n)},delete:async t=>{e.delete(t)},list:async()=>Array.from(e.keys())}}_mockMedia(){return{upload:async e=>({id:`media_${Math.random().toString(36).substr(2,9)}`,url:e}),getMediaById:async e=>({id:e,url:`https://mock.reddit.com/${e}.jpg`})}}_mockUI(){return{showToast:e=>{console.log(`[MockUI] Toast: ${typeof e=="string"?e:e.text}`)},navigateTo:e=>{console.log(`[MockUI] Navigating to: ${e}`)},showForm:e=>(console.log(`[MockUI] Showing form: ${e}`),Promise.resolve({values:{}}))}}}class pe{si;userId;startTime;totalActiveTime=0;lastVisibleStart;constructor(e,t="anon"){this.si=e,this.userId=t,this.startTime=Date.now(),this.lastVisibleStart=Date.now(),typeof document<"u"&&this.attach()}attach(){document.addEventListener("visibilitychange",()=>{if(document.hidden){const e=Date.now()-this.lastVisibleStart;this.totalActiveTime+=e,this.si.capture("session_visibility_hidden",this.userId,{active_segment_ms:e,total_active_ms:this.totalActiveTime})}else this.lastVisibleStart=Date.now(),this.si.capture("session_visibility_visible",this.userId,{})}),window.addEventListener("beforeunload",()=>{const e=Date.now()-this.lastVisibleStart;document.hidden||(this.totalActiveTime+=e),this.si.capture("session_end",this.userId,{total_duration_ms:Date.now()-this.startTime,total_active_ms:this.totalActiveTime})})}}class A{events=[];capture(e,t,n={}){const s={event_type:e,user_id:t,timestamp:Date.now(),payload:n};return this.events.push(s),console.log(`[SignalIntegrity] Captured ${e} for ${t}`,n),s}detectRageClicks(e,t=3,n=1e3){return e.length<t?!1:e.filter(i=>Date.now()-i<n).length>=t}simulateThetaSketch(e){const n=new Set(e).size;return{estimate:n,lowerBound:Math.floor(n*.98),upperBound:Math.ceil(n*1.02)}}getEvents(){return[...this.events]}clear(){this.events=[]}}const he=Object.freeze(Object.defineProperty({__proto__:null,SessionTracker:pe,SignalIntegrity:A},Symbol.toStringTag,{value:"Module"}));class fe{container=null;signalIntegrity;mockContext;constructor(e,t){this.signalIntegrity=e,this.mockContext=t}mount(e=document.body){this.container=document.createElement("div"),this.container.id="dolores-debug-overlay",this.applyStyles(),e.appendChild(this.container),this.render(),setInterval(()=>this.render(),1e3)}applyStyles(){this.container&&Object.assign(this.container.style,{position:"fixed",top:"10px",right:"10px",width:"300px",backgroundColor:"rgba(0, 0, 0, 0.85)",color:"#00ff00",fontFamily:"monospace",padding:"10px",borderRadius:"8px",zIndex:"10000",fontSize:"12px",boxShadow:"0 4px 6px rgba(0,0,0,0.3)",maxHeight:"80vh",overflowY:"auto"})}render(){if(typeof document>"u"){console.log("[DebugOverlay] Virtual Render: Metrics Updated");return}if(!this.container)return;const e=this.signalIntegrity.getEvents(),t=e.filter(n=>n.event_type==="rage_click").length;this.container.innerHTML=`
      <div style="border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 10px; font-weight: bold;">
        PROJECT DOLORES DEBUG
      </div>
      <div>
        <strong>Recent Signals:</strong>
        <ul style="list-style: none; padding: 0; margin-top: 5px;">
          ${e.slice(-5).reverse().map(n=>`
            <li style="margin-bottom: 4px; border-left: 2px solid #00aa00; padding-left: 5px;">
              [${new Date(n.timestamp).toLocaleTimeString()}] ${n.event_type}
            </li>
          `).join("")}
        </ul>
      </div>
      <div style="margin-top: 10px; padding-top: 5px; border-top: 1px solid #333;">
        <strong>Metrics:</strong><br/>
        Rage Clicks: <span style="color: ${t>0?"#ff4444":"#00ff00"}">${t}</span><br/>
        Est. Unique Users: ${this.signalIntegrity.simulateThetaSketch(e.map(n=>n.user_id)).estimate}<br/>
        <strong>Bucket:</strong> <span style="color: #00ffff">${this.mockContext.getBucket()}</span>
      </div>
    `}}class me{context;si;productId;container=null;constructor(e,t,n="gold_100"){this.context=e,this.si=t,this.productId=n}async render(e=null){if(typeof document>"u"){console.log(`[GoldGate] Virtual Render: Discovered Product ${this.productId}`);return}const t=e||document.body,n=this.context.getBucket(),i=(await this.context.reddit.getProducts()).find(c=>c.id===this.productId);if(!i){console.error(`[GoldGate] Product ${this.productId} not found`);return}const d=n==="treatment"?Math.floor(i.price_gold*.8):i.price_gold;this.container=document.createElement("div"),this.container.id="gold-gate-container",this.applyStyles(),this.container.innerHTML=`
      <div style="background: #1a1a1b; color: #d7dadc; padding: 20px; border-radius: 8px; border: 1px solid #343536; text-align: center; width: 350px;">
        <h3 style="margin-top: 0; color: #ffd700;">Exclusive Offer</h3>
        <p style="font-size: 14px;">Get <strong>${i.name}</strong> to unlock premium features.</p>
        <div style="margin: 20px 0;">
          <span style="font-size: 24px; font-weight: bold; color: ${n==="treatment"?"#44ff44":"#ffffff"}">
            ${d} Gold
          </span>
          ${n==="treatment"?`<br/><small style="text-decoration: line-through; opacity: 0.6;">${i.price_gold} Gold</small>`:""}
        </div>
        <button id="gold-gate-buy-btn" style="background: #ff4500; color: white; border: none; padding: 12px 24px; border-radius: 999px; cursor: pointer; font-weight: bold; width: 100%;">
          Purchase Now
        </button>
        <p style="font-size: 10px; margin-top: 10px; opacity: 0.5;">Experiment Bucket: ${n}</p>
      </div>
    `,t.appendChild(this.container),document.getElementById("gold-gate-buy-btn")?.addEventListener("click",async()=>{this.si.capture("gold_gate_click","user_id",{bucket:n,price:d});const c=await this.context.reddit.pay({productId:this.productId});c.status==="success"?(this.si.capture("gold_gate_purchase_success","user_id",{bucket:n}),alert("Purchase successful!")):(this.si.capture("gold_gate_purchase_failed","user_id",{bucket:n,reason:c.reason}),alert(`Purchase failed: ${c.reason}`))}),this.si.capture("gold_gate_impression","user_id",{bucket:n,price:d})}applyStyles(){this.container&&Object.assign(this.container.style,{position:"fixed",bottom:"100px",right:"20px",zIndex:"9999",fontFamily:"sans-serif"})}}class ge{config;container=null;constructor(e){this.config=e}renderData(e,t=0){if(typeof document>"u")return"";let n=`<ul style="list-style: none; padding-left: ${t*15}px;">`;for(const s in e){const i=e[s],d=typeof i=="object"&&i!==null;n+='<li style="margin-bottom: 5px;">',d?(n+=`<div style="font-weight: bold; cursor: pointer;">‚ñ∂ ${s}</div>`,n+=this.renderData(i,t+1)):n+=`
          <div style="display: flex; justify-content: space-between; width: 200px;">
            <span style="opacity: 0.8;">${s}:</span>
            <input type="text" value="${i}" style="width: 80px; background: #333; color: white; border: none;" />
          </div>
        `,n+="</li>"}return n+="</ul>",n}renderCLI(e=this.config,t=""){let n="";const s=Object.entries(e);return s.forEach(([i,d],c)=>{const u=c===s.length-1,f=u?"‚îî‚îÄ‚îÄ ":"‚îú‚îÄ‚îÄ ",g=t+(u?"    ":"‚îÇ   ");typeof d=="object"&&d!==null?(n+=`${t}${f}${i}
`,n+=this.renderCLI(d,g)):n+=`${t}${f}${i}: ${d}
`}),n}}class ye{constructor(e){this.width=10,this.height=10,this.context=e}async setPixel(e,t,n){if(e<0||e>=this.width||t<0||t>=this.height)throw new Error("Coordinates out of bounds");const s=`pixel:${e}:${t}`;await this.context.redis.set(s,n),this.context.realtime.send("board_update",{x:e,y:t,color:n}),console.log(`[PixelBoard] Set pixel (${e}, ${t}) to ${n}`)}async getBoard(){const e=Array(this.height).fill(null).map(()=>Array(this.width).fill("#ffffff"));for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++){const s=await this.context.redis.get(`pixel:${n}:${t}`);s&&(e[t][n]=s)}return e}}class L{constructor(){}static getInstance(){return L.instance||(L.instance=new L),L.instance}async analyzeResponse(e,t){if(await new Promise(i=>setTimeout(i,800)),t.split(" ").length<5)return null;const n=t.toLowerCase();if(n.includes("color")||n.includes("palette")||n.includes("red")||n.includes("blue"))return"Interesting choice of colors. Did you find the current palette sufficient for your expression?";if(n.includes("grid")||n.includes("size")||n.includes("small")||n.includes("big"))return"How would a different grid size change your strategy?";if(n.includes("click")||n.includes("place")||n.includes("mouse")||n.includes("tap"))return"Did the interaction feel responsive enough during rapid placement?";if(n.includes("feature")||n.includes("add")||n.includes("wish"))return"If we added that feature, what is the first thing you would build with it?";const s=["Can you elaborate a bit more on that?","That's a unique perspective. Why do you feel that way?","How did that impact your overall decision making?"];return s[Math.floor(Math.random()*s.length)]}}class ve{constructor(){this.questions=[],this.currentIndex=0,this.container=null,this.isOpen=!1,this.moderator=L.getInstance(),this.seedQuestions()}seedQuestions(){this.questions=[{id:"q1",text:"How would you rate your experience placing pixels?",type:"rating"},{id:"q2",text:"Did you find the 'Buy Premium' option intrusive?",type:"binary"},{id:"q3",text:"What motivated you to choose the colors you used?",type:"open"},{id:"q4",text:"How likely are you to recommend this to a friend?",type:"rating"},{id:"q5",text:"If you could add one feature, what would it be?",type:"open"},{id:"q6",text:"Do you prefer the current grid size?",type:"binary"},{id:"q7",text:"Rate the responsiveness of the interface.",type:"rating"},{id:"q8",text:"Any final thoughts?",type:"open"}]}getQuestions(){return[...this.questions]}addQuestion(e){this.questions.push(e)}updateQuestion(e,t){const n=this.questions.findIndex(s=>s.id===e);n!==-1&&(this.questions[n]={...this.questions[n],...t})}deleteQuestion(e){this.questions=this.questions.filter(t=>t.id!==e)}start(){this.isOpen||(this.isOpen=!0,this.currentIndex=0,this.renderOverlay(),this.showQuestion())}renderOverlay(){this.container=document.createElement("div"),this.container.id="qualitative-study-overlay",Object.assign(this.container.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.85)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"10000",color:"white"}),document.body.appendChild(this.container)}async showQuestion(){if(!this.container)return;if(this.container.innerHTML="",this.currentIndex>=this.questions.length){this.showCompletion();return}const e=this.questions[this.currentIndex],t=document.createElement("div");Object.assign(t.style,{backgroundColor:"#222",padding:"30px",borderRadius:"12px",maxWidth:"500px",width:"90%",textAlign:"center",border:"1px solid #444"});const n=e.id.startsWith("follow_up"),s=document.createElement("h3");s.innerText=n?"Gemini Follow-up":`Question ${this.currentIndex+1}/${this.questions.length}`,n&&(s.style.color="#4dabf7");const i=document.createElement("p");i.innerText=e.text,i.style.fontSize="1.2em",i.style.margin="20px 0",t.appendChild(s),t.appendChild(i);const d=document.createElement("div");if(e.type==="rating"){const c=document.createElement("div");c.style.fontSize="2em",c.style.cursor="pointer",[1,2,3,4,5].forEach(u=>{const f=document.createElement("span");f.innerText="‚òÖ",f.style.color="#444",f.style.margin="0 5px",f.onclick=()=>{Array.from(c.children).forEach((g,x)=>{g.style.color=x<u?"gold":"#444"}),setTimeout(()=>this.nextQuestion(u.toString()),400)},c.appendChild(f)}),d.appendChild(c)}else if(e.type==="binary")["Yes","No"].forEach(c=>{const u=document.createElement("button");u.innerText=c,Object.assign(u.style,{margin:"10px",padding:"10px 30px",fontSize:"1em",cursor:"pointer",background:"#333",color:"white",border:"1px solid #666",borderRadius:"5px"}),u.onclick=()=>this.nextQuestion(c),d.appendChild(u)});else if(e.type==="open"){const c=document.createElement("textarea");Object.assign(c.style,{width:"100%",height:"100px",background:"#111",color:"white",border:"1px solid #555",padding:"10px",fontSize:"1em",borderRadius:"5px",marginBottom:"15px"}),d.appendChild(c);const u=document.createElement("button");u.innerText="Submit Answer",Object.assign(u.style,{padding:"10px 20px",background:"#d93025",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}),u.onclick=()=>{c.value.trim().length>0&&this.nextQuestion(c.value)},d.appendChild(u)}t.appendChild(d),this.container.appendChild(t)}async nextQuestion(e){const t=this.questions[this.currentIndex];if(t.type==="open"&&!t.id.startsWith("follow_up")){this.container.innerHTML+='<p style="color:#aaa; margin-top:20px;">Gemini is analyzing your response...</p>';const n=await this.moderator.analyzeResponse(t.text,e);if(n){const s={id:`follow_up_${Date.now()}`,text:n,type:"open"};this.questions.splice(this.currentIndex+1,0,s)}}this.currentIndex++,this.showQuestion()}showCompletion(){this.container&&(this.container.innerHTML=`
            <div style="text-align:center; background:#222; padding:40px; border-radius:12px; max-width:500px; width:90%;">
                <h2 style="color:gold;">Study Complete!</h2>
                <p>Thank you for participating in our qualitative research.</p>
                <div style="font-size:3em; margin:20px;">üéÅ</div>
                <p>You've earned the <strong>Research Contributor</strong> badge.</p>
                <button id="close-study-btn" style="margin-top:20px; padding:10px 20px; font-size:1.1em; cursor:pointer;">Return to Game</button>
            </div>
        `,document.getElementById("close-study-btn")?.addEventListener("click",()=>{this.container?.remove(),this.container=null,this.isOpen=!1}))}}class xe{constructor(e){this.container=null,this.isOpen=!1,this.study=e}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen||(this.isOpen=!0,this.render())}close(){this.container&&(this.container.remove(),this.container=null),this.isOpen=!1}render(){this.container=document.createElement("div"),Object.assign(this.container.style,{position:"fixed",top:"10px",right:"10px",bottom:"10px",width:"400px",backgroundColor:"#1a1a1a",border:"1px solid #444",borderRadius:"8px",boxShadow:"-2px 0 10px rgba(0,0,0,0.5)",zIndex:"20000",display:"flex",flexDirection:"column",color:"#eee",fontFamily:"sans-serif"});const e=document.createElement("div");Object.assign(e.style,{padding:"15px",background:"#2d2d2d",borderBottom:"1px solid #444",display:"flex",justifyContent:"space-between",alignItems:"center"}),e.innerHTML="<strong>Moderator Dashboard</strong>";const t=document.createElement("button");t.innerText="‚úï",t.onclick=()=>this.close(),e.appendChild(t),this.container.appendChild(e);const n=document.createElement("div");Object.assign(n.style,{flex:"1",overflowY:"auto",padding:"15px"}),this.renderQuestionList(n),this.container.appendChild(n);const s=document.createElement("div");Object.assign(s.style,{padding:"15px",borderTop:"1px solid #444"});const i=document.createElement("button");i.innerText="+ Add Question",Object.assign(i.style,{width:"100%",padding:"8px",cursor:"pointer",backgroundColor:"#4dabf7",border:"none",borderRadius:"4px",color:"white"}),i.onclick=()=>{const d={id:`manual_${Date.now()}`,text:"New Question",type:"open"};this.study.addQuestion(d),this.renderQuestionList(n)},s.appendChild(i),this.container.appendChild(s),document.body.appendChild(this.container)}renderQuestionList(e){e.innerHTML="",this.study.getQuestions().forEach((n,s)=>{const i=document.createElement("div");Object.assign(i.style,{background:"#333",marginBottom:"10px",padding:"10px",borderRadius:"4px",border:"1px solid #555"});const d=document.createElement("div");d.style.display="flex",d.style.justifyContent="space-between",d.style.marginBottom="5px";const c=document.createElement("span");c.innerText=n.type.toUpperCase(),c.style.fontSize="0.7em",c.style.background="#000",c.style.padding="2px 5px",c.style.borderRadius="3px";const u=document.createElement("div"),f=document.createElement("button");f.innerText="‚úé",f.style.marginRight="5px",f.onclick=()=>this.editQuestion(n,i);const g=document.createElement("button");g.innerText="üóë",g.style.color="red",g.onclick=()=>{confirm("Delete this question?")&&(this.study.deleteQuestion(n.id),this.renderQuestionList(e))},u.appendChild(f),u.appendChild(g),d.appendChild(c),d.appendChild(u);const x=document.createElement("div");x.innerText=`${s+1}. ${n.text}`,i.appendChild(d),i.appendChild(x),e.appendChild(i)})}editQuestion(e,t){t.innerHTML="";const n=document.createElement("input");n.value=e.text,Object.assign(n.style,{width:"100%",padding:"5px",marginBottom:"5px"});const s=document.createElement("select");["open","binary","rating"].forEach(d=>{const c=document.createElement("option");c.value=d,c.text=d,d===e.type&&(c.selected=!0),s.appendChild(c)});const i=document.createElement("button");i.innerText="Save",i.onclick=()=>{this.study.updateQuestion(e.id,{text:n.value,type:s.value});const d=t.parentElement;d&&this.renderQuestionList(d)},t.appendChild(n),t.appendChild(s),t.appendChild(i)}}class be{static async selectRole(){return new Promise(e=>{const t=document.createElement("div");Object.assign(t.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"#111",color:"white",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"100000",fontFamily:"sans-serif"});const n=document.createElement("h1");n.innerText="Select Your Role",n.style.marginBottom="40px",t.appendChild(n);const s=(d,c,u,f)=>{const g=document.createElement("div");Object.assign(g.style,{background:"#222",border:"1px solid #444",padding:"20px",margin:"10px",width:"300px",cursor:"pointer",borderRadius:"8px",textAlign:"left",transition:"background 0.2s",display:"flex",alignItems:"center"}),g.onmouseover=()=>g.style.background="#333",g.onmouseout=()=>g.style.background="#222",g.onclick=()=>{t.remove(),e(c)};const x=document.createElement("div");x.innerText=f,x.style.fontSize="2.5em",x.style.marginRight="20px";const w=document.createElement("div"),b=document.createElement("div");b.innerText=d,b.style.fontSize="1.2em",b.style.fontWeight="bold";const E=document.createElement("div");return E.innerText=u,E.style.color="#888",E.style.fontSize="0.9em",E.style.marginTop="5px",w.appendChild(b),w.appendChild(E),g.appendChild(x),g.appendChild(w),g};t.appendChild(s("Study Participant","participant","Play the game and take the survey. (Standard User)","üë§")),t.appendChild(s("Study Designer","designer","Construct and edit the qualitative study questions.","üõ†Ô∏è")),t.appendChild(s("Moderator","moderator","Monitor live activity and study results.","üìä")),document.body.appendChild(t);const i=document.getElementById("status-bar");i&&(i.style.zIndex="0")})}}class we{constructor(){this.container=null,this.logs=[],this.listContainer=null,this.render()}log(e){const t=new Date().toLocaleTimeString();this.logs.unshift(`[${t}] ${e}`),this.renderLogs()}render(){this.container=document.createElement("div"),Object.assign(this.container.style,{position:"absolute",top:"0",left:"0",width:"100vw",height:"100vh",backgroundColor:"#050505",color:"#00ff00",fontFamily:"monospace",padding:"20px",boxSizing:"border-box",overflow:"hidden",display:"flex",flexDirection:"column"});const e=document.createElement("h2");e.innerText="üìä Live Study Monitor",e.style.borderBottom="1px solid #333",e.style.paddingBottom="10px",e.style.marginBottom="20px",this.container.appendChild(e);const t=document.createElement("div");t.style.display="flex",t.style.gap="20px",t.style.marginBottom="20px";const n=(i,d)=>{const c=document.createElement("div");c.style.background="#111",c.style.padding="15px",c.style.minWidth="150px",c.style.border="1px solid #333";const u=document.createElement("div");u.innerText=i,u.style.color="#888";const f=document.createElement("div");return f.innerText=d,f.style.fontSize="2em",f.id=`stat-${i.replace(" ","-")}`,c.appendChild(u),c.appendChild(f),c};t.appendChild(n("Active Users","1")),t.appendChild(n("Survey Completes","0")),this.container.appendChild(t);const s=document.createElement("div");s.innerText="> Event Stream",s.style.color="#fff",s.style.marginBottom="10px",this.container.appendChild(s),this.listContainer=document.createElement("div"),Object.assign(this.listContainer.style,{flex:"1",overflowY:"auto",background:"#0a0a0a",border:"1px solid #333",padding:"10px",fontSize:"1.1em"}),this.container.appendChild(this.listContainer),document.body.appendChild(this.container),this.log("Session started. Listening for events...")}renderLogs(){this.listContainer&&(this.listContainer.innerHTML="",this.logs.forEach(e=>{const t=document.createElement("div");t.innerText=e,t.style.padding="5px 0",t.style.borderBottom="1px solid #111",this.listContainer.appendChild(t)}))}}if(typeof document<"u"){const h=document.getElementById("status-bar");h&&(h.innerText="Initializing scripts..."),window.onerror=(e,t,n,s,i)=>(h&&(h.innerText=`CRITICAL ERROR: ${e}
Line: ${n}`,h.style.color="red"),!1)}const Ee=async()=>{const h=await be.selectRole();console.log(`Starting in role: ${h}`);const e=document.getElementById("status-bar"),t=v=>{console.log(v),e&&(e.innerText=v)};t("Step 1: Imports loaded. Initializing Context...");const n=new ue({userId:"t2_browser_user",bucketId:"treatment"});t("Step 2: Context ready. Initializing SignalIntegrity..."),await new Promise(v=>setTimeout(v,100));const s=new A;new(await F(async()=>{const{SessionTracker:v}=await Promise.resolve().then(()=>he);return{SessionTracker:v}},void 0)).SessionTracker(s,"t2_browser_user"),t("Step 3: App components initializing..."),await new Promise(v=>setTimeout(v,100));const i=new ve;if(h==="designer"){t("Initializing Designer Mode...");const v=document.getElementById("game-container");v&&(v.style.display="none"),new xe(i).open(),e&&(e.innerText="Designer Mode Active. Edit your study.");return}if(h==="moderator"){t("Initializing Moderator Mode...");const v=document.getElementById("game-container");v&&(v.style.display="none"),new we,e&&(e.style.display="none");return}const d=new ye(n),c=new fe(s,n),u=new ge(n.config);let f=0;t("Step 4: Rendering UI (Participant)...");const g=document.getElementById("config-menu-container");g&&(g.innerHTML="<h3>Vibe Coding Menu</h3>"+u.renderData(n.config)),c.mount(),setInterval(()=>c.render(),1e3);const x=document.getElementById("game-container"),w=document.getElementById("status-bar");if(!x)return;const b=10;x.style.gridTemplateColumns=`repeat(${b}, 1fr)`;const E=async()=>{const v=await d.getBoard();x.innerHTML="",v.forEach((T,S)=>{T.forEach((r,o)=>{const a=document.createElement("div");a.className="pixel",a.style.backgroundColor=r,a.title=`(${o}, ${S})`,a.onclick=async()=>{try{const l=n.config.Visuals?.Animations?.placePixelDuration||300;a.style.transition=`transform ${l}ms`,a.style.transform="scale(0.5)",await d.setPixel(o,S,n.config.Visuals?.Colors?.primary||"#FF4500"),s.capture("pixel_place","t2_browser_user",{x:o,y:S}),f++,f===3&&P();const p=Date.now();window.lastClickTimes||(window.lastClickTimes=[]),window.lastClickTimes.push(p),window.lastClickTimes=window.lastClickTimes.filter(y=>p-y<1e3),setTimeout(()=>a.style.transform="scale(1)",100)}catch(l){console.error(l)}},x.appendChild(a)})})};n.realtime.connect().subscribe("board_update",v=>{E()}),await E(),w&&(w.innerText="Connected. Place 3 pixels to unlock survey!");const C=document.createElement("button");C.innerText="Buy Premium Palette",C.style.marginTop="20px",C.style.padding="10px 20px",C.onclick=async()=>{new me(n,s,"custom_avatar_rare").render()},document.body.appendChild(C);const P=()=>{const v=document.createElement("button");v.innerText="üìã Take Research Survey",Object.assign(v.style,{display:"block",marginTop:"10px",padding:"10px 20px",backgroundColor:"#009688",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"1em"}),v.onclick=()=>i.start(),C.insertAdjacentElement("afterend",v)}};Ee().catch(h=>{console.error(h);const e=document.getElementById("status-bar");e&&(e.innerText=`Error: ${h.message}`,e.style.color="red")});
