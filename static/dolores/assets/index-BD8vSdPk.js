(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();const N="modulepreload",z=function(f){return"/dolores/"+f},j={},Q=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){let m=function(v){return Promise.all(v.map(b=>Promise.resolve(b).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};var c=m;document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),p=d?.nonce||d?.getAttribute("nonce");a=m(t.map(v=>{if(v=z(v),v in j)return;j[v]=!0;const b=v.endsWith(".css"),w=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${w}`))return;const x=document.createElement("link");if(x.rel=b?"stylesheet":N,b||(x.as="script"),x.crossOrigin="",x.href=v,p&&x.setAttribute("nonce",p),document.head.appendChild(x),b)return new Promise((C,E)=>{x.addEventListener("load",C),x.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${v}`)))})}))}function o(d){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=d,window.dispatchEvent(p),!p.defaultPrevented)throw d}return a.then(d=>{for(const p of d||[])p.status==="rejected"&&o(p.reason);return e().catch(o)})};function P(){throw new Error("Buffer is not included.")}P.isBuffer=function(){return!1};var F=50;const U=Object.freeze(Object.defineProperty({__proto__:null,Buffer:P,INSPECT_MAX_BYTES:F,SlowBuffer:P},Symbol.toStringTag,{value:"Module"})),H={};function k(){}function G(){for(var f=arguments.length,e=new Array(f),t=0;t<f;t++)e[t]=arguments[t];var n=e[0];e.shift(),setTimeout(function(){typeof n=="function"&&n.apply(null,e)},0)}function V(f){throw new Error("No such module. (Possibly not yet loaded)")}var W={},T="browser",K=1,Y=!0,J={},X=[],$="/";function Z(){return $}function ee(f){$=H.resolve(f,$)}const te=Object.freeze(Object.defineProperty({__proto__:null,arch:T,argv:X,binding:V,browser:Y,chdir:ee,cwd:Z,dlopen:k,env:J,execPath:T,exit:k,features:W,kill:k,memoryUsage:k,nextTick:G,pid:K,platform:T,title:T,umask:k,uptime:k,uvCounters:k},Symbol.toStringTag,{value:"Module"}));globalThis.Buffer=P||void 0||U;globalThis.process=te;class ne{products=new Map;constructor(e=[]){e.forEach(t=>this.products.set(t.id,t))}getProducts(){return Array.from(this.products.values())}getProduct(e){return this.products.get(e)}purchase(e){const t=this.products.get(e);return t?t.sold_out||t.stock<=0?{success:!1,reason:"Sold out"}:(t.stock-=1,t.stock===0&&(t.sold_out=!0),{success:!0}):{success:!1,reason:"Product not found"}}updateStock(e,t){const n=this.products.get(e);n&&(n.stock=t,n.sold_out=t<=0)}}var O={exports:{}},A;function oe(){if(A)return O.exports;A=1;var f=typeof Reflect=="object"?Reflect:null,e=f&&typeof f.apply=="function"?f.apply:function(i,r,l){return Function.prototype.apply.call(i,r,l)},t;f&&typeof f.ownKeys=="function"?t=f.ownKeys:Object.getOwnPropertySymbols?t=function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:t=function(i){return Object.getOwnPropertyNames(i)};function n(s){console&&console.warn&&console.warn(s)}var a=Number.isNaN||function(i){return i!==i};function o(){o.init.call(this)}O.exports=o,O.exports.once=y,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function d(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(s){if(typeof s!="number"||s<0||a(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");c=s}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||a(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this};function p(s){return s._maxListeners===void 0?o.defaultMaxListeners:s._maxListeners}o.prototype.getMaxListeners=function(){return p(this)},o.prototype.emit=function(i){for(var r=[],l=1;l<arguments.length;l++)r.push(arguments[l]);var u=i==="error",g=this._events;if(g!==void 0)u=u&&g.error===void 0;else if(!u)return!1;if(u){var h;if(r.length>0&&(h=r[0]),h instanceof Error)throw h;var _=new Error("Unhandled error."+(h?" ("+h.message+")":""));throw _.context=h,_}var I=g[i];if(I===void 0)return!1;if(typeof I=="function")e(I,this,r);else for(var B=I.length,q=C(I,B),l=0;l<B;++l)e(q[l],this,r);return!0};function m(s,i,r,l){var u,g,h;if(d(r),g=s._events,g===void 0?(g=s._events=Object.create(null),s._eventsCount=0):(g.newListener!==void 0&&(s.emit("newListener",i,r.listener?r.listener:r),g=s._events),h=g[i]),h===void 0)h=g[i]=r,++s._eventsCount;else if(typeof h=="function"?h=g[i]=l?[r,h]:[h,r]:l?h.unshift(r):h.push(r),u=p(s),u>0&&h.length>u&&!h.warned){h.warned=!0;var _=new Error("Possible EventEmitter memory leak detected. "+h.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit");_.name="MaxListenersExceededWarning",_.emitter=s,_.type=i,_.count=h.length,n(_)}return s}o.prototype.addListener=function(i,r){return m(this,i,r,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(i,r){return m(this,i,r,!0)};function v(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function b(s,i,r){var l={fired:!1,wrapFn:void 0,target:s,type:i,listener:r},u=v.bind(l);return u.listener=r,l.wrapFn=u,u}o.prototype.once=function(i,r){return d(r),this.on(i,b(this,i,r)),this},o.prototype.prependOnceListener=function(i,r){return d(r),this.prependListener(i,b(this,i,r)),this},o.prototype.removeListener=function(i,r){var l,u,g,h,_;if(d(r),u=this._events,u===void 0)return this;if(l=u[i],l===void 0)return this;if(l===r||l.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete u[i],u.removeListener&&this.emit("removeListener",i,l.listener||r));else if(typeof l!="function"){for(g=-1,h=l.length-1;h>=0;h--)if(l[h]===r||l[h].listener===r){_=l[h].listener,g=h;break}if(g<0)return this;g===0?l.shift():E(l,g),l.length===1&&(u[i]=l[0]),u.removeListener!==void 0&&this.emit("removeListener",i,_||r)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(i){var r,l,u;if(l=this._events,l===void 0)return this;if(l.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):l[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete l[i]),this;if(arguments.length===0){var g=Object.keys(l),h;for(u=0;u<g.length;++u)h=g[u],h!=="removeListener"&&this.removeAllListeners(h);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=l[i],typeof r=="function")this.removeListener(i,r);else if(r!==void 0)for(u=r.length-1;u>=0;u--)this.removeListener(i,r[u]);return this};function w(s,i,r){var l=s._events;if(l===void 0)return[];var u=l[i];return u===void 0?[]:typeof u=="function"?r?[u.listener||u]:[u]:r?R(u):C(u,u.length)}o.prototype.listeners=function(i){return w(this,i,!0)},o.prototype.rawListeners=function(i){return w(this,i,!1)},o.listenerCount=function(s,i){return typeof s.listenerCount=="function"?s.listenerCount(i):x.call(s,i)},o.prototype.listenerCount=x;function x(s){var i=this._events;if(i!==void 0){var r=i[s];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function C(s,i){for(var r=new Array(i),l=0;l<i;++l)r[l]=s[l];return r}function E(s,i){for(;i+1<s.length;i++)s[i]=s[i+1];s.pop()}function R(s){for(var i=new Array(s.length),r=0;r<i.length;++r)i[r]=s[r].listener||s[r];return i}function y(s,i){return new Promise(function(r,l){function u(h){s.removeListener(i,g),l(h)}function g(){typeof s.removeListener=="function"&&s.removeListener("error",u),r([].slice.call(arguments))}L(s,i,g,{once:!0}),i!=="error"&&M(s,u,{once:!0})})}function M(s,i,r){typeof s.on=="function"&&L(s,"error",i,r)}function L(s,i,r,l){if(typeof s.on=="function")l.once?s.once(i,r):s.on(i,r);else if(typeof s.addEventListener=="function")s.addEventListener(i,function u(g){l.once&&s.removeEventListener(i,u),r(g)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}return O.exports}var ie=oe();class se{emitter;channelHandlers=new Map;constructor(){this.emitter=new ie.EventEmitter}subscribe(e,t){this.channelHandlers.has(e)||this.channelHandlers.set(e,new Set),this.channelHandlers.get(e).add(t),this.emitter.on(e,t),console.log(`[RealtimeMock] Subscribed to ${e}`)}publish(e,t){const n=Math.floor(Math.random()*50);setTimeout(()=>{this.emitter.emit(e,t),console.log(`[RealtimeMock] Published to ${e} with ${n}ms latency`,t)},n)}unsubscribe(e,t){const n=this.channelHandlers.get(e);n&&(n.delete(t),this.emitter.off(e,t))}send(e,t){return this.publish(e,t)}connect(){return console.log("[RealtimeMock] Connected (Simulated)"),this}}const re=[{id:"gold_100",name:"100 Reddit Gold",price_gold:100,stock:999,sold_out:!1},{id:"gold_500",name:"500 Reddit Gold",price_gold:450,stock:100,sold_out:!1},{id:"custom_avatar_rare",name:"Ultra Rare Avatar",price_gold:500,stock:5,sold_out:!1}],ae={Timers:{cooldownMs:5e3,respawnMs:3e3},Limits:{maxDailyPixels:100,maxStackSize:5}},ce={Animations:{placePixelDuration:300,overlayFadeIn:150,easing:"cubic-bezier(0.4, 0, 0.2, 1)"},Colors:{primary:"#FF4500",secondary:"#0079D3",error:"#FF0000",success:"#00BA7C",canvasBackground:"#FFFFFF"}},de={Onboarding:{welcomeTitle:"Welcome to Pixel Placer",welcomeBody:"Place pixels and create art together!"},Errors:{cooldown:"You are doing that too much. Take a break!",soldOut:"Sorry, we are all out of pixels."},Buttons:{place:"Place Pixel",buy:"Get More"}},le={Gameplay:ae,Visuals:ce,Copy:de};class ue{userId;subredditId;bucketId;reddit;redis;realtime;kv;media;ui;config;_state;economy;constructor(e={}){this.userId=e.userId||"t2_user123",this.subredditId=e.subredditId||"t5_sub456",this.bucketId=e.bucketId||(Math.random()>.5?"treatment":"control"),this.config=le,this.economy=new ne(e.initialProducts||re),this.reddit=this._mockReddit(),this.redis=this._mockRedis(),this.realtime=new se,this.kv=this._mockKV(),this.media=this._mockMedia(),this._state=new Map,this.ui=this._mockUI()}getBucket(){return this.bucketId}useState(e){const t=JSON.stringify(e);return this._state.has(t)||this._state.set(t,e),[this._state.get(t),n=>{const a=this._state.get(t),o=typeof n=="function"?n(a):n;this._state.set(t,o)}]}_mockReddit(){return{getCurrentUser:async()=>({id:this.userId,name:"dummy_user"}),getSubredditById:async e=>({id:e,name:"test_sub"}),getCurrentSubreddit:async()=>({id:this.subredditId,name:"test_sub"}),getProducts:async()=>this.economy.getProducts(),pay:async e=>{const t=this.economy.getProduct(e.productId),n=this.economy.purchase(e.productId);return console.log(`[MockEconomy] Triggering Modal for ${t?.name||e.productId}`),n.success?{status:"success"}:{status:"failed",reason:n.reason}}}}_mockRedis(){const e=new Map,t=typeof process<"u"&&process.versions!=null&&process.versions.node!=null,n=".dolores_redis_dump.json",a="dolores_redis_dump";if(t)try{const c=require("fs");if(c.existsSync(n)){const d=JSON.parse(c.readFileSync(n,"utf-8"));Object.entries(d).forEach(([p,m])=>e.set(p,m)),console.log("[MockRedis] Loaded persistent state from disk.")}}catch(c){console.warn("[MockRedis] Failed to load persistent state:",c)}else if(typeof localStorage<"u")try{const c=localStorage.getItem(a);if(c){const d=JSON.parse(c);Object.entries(d).forEach(([p,m])=>e.set(p,m)),console.log("[MockRedis] Loaded persistent state from localStorage.")}}catch(c){console.warn("[MockRedis] Failed to load localStorage:",c)}const o=()=>{const c=Object.fromEntries(e),d=JSON.stringify(c,null,2);if(t)try{require("fs").writeFileSync(n,d)}catch(p){console.error("[MockRedis] Persistence failed:",p)}else typeof localStorage<"u"&&localStorage.setItem(a,d)};return{get:async c=>e.get(c),set:async(c,d)=>{e.set(c,d),o()},del:async c=>{e.delete(c),o()},hGet:async(c,d)=>(e.get(c)||{})[d],hSet:async(c,d,p)=>{const m=e.get(c)||{};m[d]=p,e.set(c,m),o()}}}_mockKV(){const e=new Map;return{get:async t=>e.get(t),put:async(t,n)=>{e.set(t,n)},delete:async t=>{e.delete(t)},list:async()=>Array.from(e.keys())}}_mockMedia(){return{upload:async e=>({id:`media_${Math.random().toString(36).substr(2,9)}`,url:e}),getMediaById:async e=>({id:e,url:`https://mock.reddit.com/${e}.jpg`})}}_mockUI(){return{showToast:e=>{console.log(`[MockUI] Toast: ${typeof e=="string"?e:e.text}`)},navigateTo:e=>{console.log(`[MockUI] Navigating to: ${e}`)},showForm:e=>(console.log(`[MockUI] Showing form: ${e}`),Promise.resolve({values:{}}))}}}class pe{si;userId;startTime;totalActiveTime=0;lastVisibleStart;constructor(e,t="anon"){this.si=e,this.userId=t,this.startTime=Date.now(),this.lastVisibleStart=Date.now(),typeof document<"u"&&this.attach()}attach(){document.addEventListener("visibilitychange",()=>{if(document.hidden){const e=Date.now()-this.lastVisibleStart;this.totalActiveTime+=e,this.si.capture("session_visibility_hidden",this.userId,{active_segment_ms:e,total_active_ms:this.totalActiveTime})}else this.lastVisibleStart=Date.now(),this.si.capture("session_visibility_visible",this.userId,{})}),window.addEventListener("beforeunload",()=>{const e=Date.now()-this.lastVisibleStart;document.hidden||(this.totalActiveTime+=e),this.si.capture("session_end",this.userId,{total_duration_ms:Date.now()-this.startTime,total_active_ms:this.totalActiveTime})})}}class D{events=[];capture(e,t,n={}){const a={event_type:e,user_id:t,timestamp:Date.now(),payload:n};return this.events.push(a),console.log(`[SignalIntegrity] Captured ${e} for ${t}`,n),a}detectRageClicks(e,t=3,n=1e3){return e.length<t?!1:e.filter(o=>Date.now()-o<n).length>=t}simulateThetaSketch(e){const n=new Set(e).size;return{estimate:n,lowerBound:Math.floor(n*.98),upperBound:Math.ceil(n*1.02)}}getEvents(){return[...this.events]}clear(){this.events=[]}}const fe=Object.freeze(Object.defineProperty({__proto__:null,SessionTracker:pe,SignalIntegrity:D},Symbol.toStringTag,{value:"Module"}));class he{container=null;signalIntegrity;mockContext;constructor(e,t){this.signalIntegrity=e,this.mockContext=t}mount(e=document.body){this.container=document.createElement("div"),this.container.id="dolores-debug-overlay",this.applyStyles(),e.appendChild(this.container),this.render(),setInterval(()=>this.render(),1e3)}applyStyles(){this.container&&Object.assign(this.container.style,{position:"fixed",top:"10px",right:"10px",width:"300px",backgroundColor:"rgba(0, 0, 0, 0.85)",color:"#00ff00",fontFamily:"monospace",padding:"10px",borderRadius:"8px",zIndex:"10000",fontSize:"12px",boxShadow:"0 4px 6px rgba(0,0,0,0.3)",maxHeight:"80vh",overflowY:"auto"})}render(){if(typeof document>"u"){console.log("[DebugOverlay] Virtual Render: Metrics Updated");return}if(!this.container)return;const e=this.signalIntegrity.getEvents(),t=e.filter(n=>n.event_type==="rage_click").length;this.container.innerHTML=`
      <div style="border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 10px; font-weight: bold;">
        PROJECT DOLORES DEBUG
      </div>
      <div>
        <strong>Recent Signals:</strong>
        <ul style="list-style: none; padding: 0; margin-top: 5px;">
          ${e.slice(-5).reverse().map(n=>`
            <li style="margin-bottom: 4px; border-left: 2px solid #00aa00; padding-left: 5px;">
              [${new Date(n.timestamp).toLocaleTimeString()}] ${n.event_type}
            </li>
          `).join("")}
        </ul>
      </div>
      <div style="margin-top: 10px; padding-top: 5px; border-top: 1px solid #333;">
        <strong>Metrics:</strong><br/>
        Rage Clicks: <span style="color: ${t>0?"#ff4444":"#00ff00"}">${t}</span><br/>
        Est. Unique Users: ${this.signalIntegrity.simulateThetaSketch(e.map(n=>n.user_id)).estimate}<br/>
        <strong>Bucket:</strong> <span style="color: #00ffff">${this.mockContext.getBucket()}</span>
      </div>
    `}}class me{context;si;productId;container=null;constructor(e,t,n="gold_100"){this.context=e,this.si=t,this.productId=n}async render(e=null){if(typeof document>"u"){console.log(`[GoldGate] Virtual Render: Discovered Product ${this.productId}`);return}const t=e||document.body,n=this.context.getBucket(),o=(await this.context.reddit.getProducts()).find(d=>d.id===this.productId);if(!o){console.error(`[GoldGate] Product ${this.productId} not found`);return}const c=n==="treatment"?Math.floor(o.price_gold*.8):o.price_gold;this.container=document.createElement("div"),this.container.id="gold-gate-container",this.applyStyles(),this.container.innerHTML=`
      <div style="background: #1a1a1b; color: #d7dadc; padding: 20px; border-radius: 8px; border: 1px solid #343536; text-align: center; width: 350px;">
        <h3 style="margin-top: 0; color: #ffd700;">Exclusive Offer</h3>
        <p style="font-size: 14px;">Get <strong>${o.name}</strong> to unlock premium features.</p>
        <div style="margin: 20px 0;">
          <span style="font-size: 24px; font-weight: bold; color: ${n==="treatment"?"#44ff44":"#ffffff"}">
            ${c} Gold
          </span>
          ${n==="treatment"?`<br/><small style="text-decoration: line-through; opacity: 0.6;">${o.price_gold} Gold</small>`:""}
        </div>
        <button id="gold-gate-buy-btn" style="background: #ff4500; color: white; border: none; padding: 12px 24px; border-radius: 999px; cursor: pointer; font-weight: bold; width: 100%;">
          Purchase Now
        </button>
        <p style="font-size: 10px; margin-top: 10px; opacity: 0.5;">Experiment Bucket: ${n}</p>
      </div>
    `,t.appendChild(this.container),document.getElementById("gold-gate-buy-btn")?.addEventListener("click",async()=>{this.si.capture("gold_gate_click","user_id",{bucket:n,price:c});const d=await this.context.reddit.pay({productId:this.productId});d.status==="success"?(this.si.capture("gold_gate_purchase_success","user_id",{bucket:n}),alert("Purchase successful!")):(this.si.capture("gold_gate_purchase_failed","user_id",{bucket:n,reason:d.reason}),alert(`Purchase failed: ${d.reason}`))}),this.si.capture("gold_gate_impression","user_id",{bucket:n,price:c})}applyStyles(){this.container&&Object.assign(this.container.style,{position:"fixed",bottom:"100px",right:"20px",zIndex:"9999",fontFamily:"sans-serif"})}}class ge{config;container=null;constructor(e){this.config=e}renderData(e,t=0){if(typeof document>"u")return"";let n=`<ul style="list-style: none; padding-left: ${t*15}px;">`;for(const a in e){const o=e[a],c=typeof o=="object"&&o!==null;n+='<li style="margin-bottom: 5px;">',c?(n+=`<div style="font-weight: bold; cursor: pointer;">‚ñ∂ ${a}</div>`,n+=this.renderData(o,t+1)):n+=`
          <div style="display: flex; justify-content: space-between; width: 200px;">
            <span style="opacity: 0.8;">${a}:</span>
            <input type="text" value="${o}" style="width: 80px; background: #333; color: white; border: none;" />
          </div>
        `,n+="</li>"}return n+="</ul>",n}renderCLI(e=this.config,t=""){let n="";const a=Object.entries(e);return a.forEach(([o,c],d)=>{const p=d===a.length-1,m=p?"‚îî‚îÄ‚îÄ ":"‚îú‚îÄ‚îÄ ",v=t+(p?"    ":"‚îÇ   ");typeof c=="object"&&c!==null?(n+=`${t}${m}${o}
`,n+=this.renderCLI(c,v)):n+=`${t}${m}${o}: ${c}
`}),n}}class ye{constructor(e){this.width=10,this.height=10,this.context=e}async setPixel(e,t,n){if(e<0||e>=this.width||t<0||t>=this.height)throw new Error("Coordinates out of bounds");const a=`pixel:${e}:${t}`;await this.context.redis.set(a,n),this.context.realtime.send("board_update",{x:e,y:t,color:n}),console.log(`[PixelBoard] Set pixel (${e}, ${t}) to ${n}`)}async getBoard(){const e=Array(this.height).fill(null).map(()=>Array(this.width).fill("#ffffff"));for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++){const a=await this.context.redis.get(`pixel:${n}:${t}`);a&&(e[t][n]=a)}return e}}class S{constructor(){}static getInstance(){return S.instance||(S.instance=new S),S.instance}async analyzeResponse(e,t){if(await new Promise(o=>setTimeout(o,800)),t.split(" ").length<5)return null;const n=t.toLowerCase();if(n.includes("color")||n.includes("palette")||n.includes("red")||n.includes("blue"))return"Interesting choice of colors. Did you find the current palette sufficient for your expression?";if(n.includes("grid")||n.includes("size")||n.includes("small")||n.includes("big"))return"How would a different grid size change your strategy?";if(n.includes("click")||n.includes("place")||n.includes("mouse")||n.includes("tap"))return"Did the interaction feel responsive enough during rapid placement?";if(n.includes("feature")||n.includes("add")||n.includes("wish"))return"If we added that feature, what is the first thing you would build with it?";const a=["Can you elaborate a bit more on that?","That's a unique perspective. Why do you feel that way?","How did that impact your overall decision making?"];return a[Math.floor(Math.random()*a.length)]}}class ve{constructor(){this.questions=[],this.currentIndex=0,this.container=null,this.isOpen=!1,this.moderator=S.getInstance(),this.seedQuestions()}seedQuestions(){this.questions=[{id:"q1",text:"How would you rate your experience placing pixels?",type:"rating"},{id:"q2",text:"Did you find the 'Buy Premium' option intrusive?",type:"binary"},{id:"q3",text:"What motivated you to choose the colors you used?",type:"open"},{id:"q4",text:"How likely are you to recommend this to a friend?",type:"rating"},{id:"q5",text:"If you could add one feature, what would it be?",type:"open"},{id:"q6",text:"Do you prefer the current grid size?",type:"binary"},{id:"q7",text:"Rate the responsiveness of the interface.",type:"rating"},{id:"q8",text:"Any final thoughts?",type:"open"}]}getQuestions(){return[...this.questions]}addQuestion(e){this.questions.push(e)}updateQuestion(e,t){const n=this.questions.findIndex(a=>a.id===e);n!==-1&&(this.questions[n]={...this.questions[n],...t})}deleteQuestion(e){this.questions=this.questions.filter(t=>t.id!==e)}start(){this.isOpen||(this.isOpen=!0,this.currentIndex=0,this.renderOverlay(),this.showQuestion())}renderOverlay(){this.container=document.createElement("div"),this.container.id="qualitative-study-overlay",Object.assign(this.container.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.85)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"10000",color:"white"}),document.body.appendChild(this.container)}async showQuestion(){if(!this.container)return;if(this.container.innerHTML="",this.currentIndex>=this.questions.length){this.showCompletion();return}const e=this.questions[this.currentIndex],t=document.createElement("div");Object.assign(t.style,{backgroundColor:"#222",padding:"30px",borderRadius:"12px",maxWidth:"500px",width:"90%",textAlign:"center",border:"1px solid #444"});const n=e.id.startsWith("follow_up"),a=document.createElement("h3");a.innerText=n?"Gemini Follow-up":`Question ${this.currentIndex+1}/${this.questions.length}`,n&&(a.style.color="#4dabf7");const o=document.createElement("p");o.innerText=e.text,o.style.fontSize="1.2em",o.style.margin="20px 0",t.appendChild(a),t.appendChild(o);const c=document.createElement("div");if(e.type==="rating"){const d=document.createElement("div");d.style.fontSize="2em",d.style.cursor="pointer",[1,2,3,4,5].forEach(p=>{const m=document.createElement("span");m.innerText="‚òÖ",m.style.color="#444",m.style.margin="0 5px",m.onclick=()=>{Array.from(d.children).forEach((v,b)=>{v.style.color=b<p?"gold":"#444"}),setTimeout(()=>this.nextQuestion(p.toString()),400)},d.appendChild(m)}),c.appendChild(d)}else if(e.type==="binary")["Yes","No"].forEach(d=>{const p=document.createElement("button");p.innerText=d,Object.assign(p.style,{margin:"10px",padding:"10px 30px",fontSize:"1em",cursor:"pointer",background:"#333",color:"white",border:"1px solid #666",borderRadius:"5px"}),p.onclick=()=>this.nextQuestion(d),c.appendChild(p)});else if(e.type==="open"){const d=document.createElement("textarea");Object.assign(d.style,{width:"100%",height:"100px",background:"#111",color:"white",border:"1px solid #555",padding:"10px",fontSize:"1em",borderRadius:"5px",marginBottom:"15px"}),c.appendChild(d);const p=document.createElement("button");p.innerText="Submit Answer",Object.assign(p.style,{padding:"10px 20px",background:"#d93025",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}),p.onclick=()=>{d.value.trim().length>0&&this.nextQuestion(d.value)},c.appendChild(p)}t.appendChild(c),this.container.appendChild(t)}async nextQuestion(e){const t=this.questions[this.currentIndex];if(t.type==="open"&&!t.id.startsWith("follow_up")){this.container.innerHTML+='<p style="color:#aaa; margin-top:20px;">Gemini is analyzing your response...</p>';const n=await this.moderator.analyzeResponse(t.text,e);if(n){const a={id:`follow_up_${Date.now()}`,text:n,type:"open"};this.questions.splice(this.currentIndex+1,0,a)}}this.currentIndex++,this.showQuestion()}showCompletion(){this.container&&(this.container.innerHTML=`
            <div style="text-align:center; background:#222; padding:40px; border-radius:12px; max-width:500px; width:90%;">
                <h2 style="color:gold;">Study Complete!</h2>
                <p>Thank you for participating in our qualitative research.</p>
                <div style="font-size:3em; margin:20px;">üéÅ</div>
                <p>You've earned the <strong>Research Contributor</strong> badge.</p>
                <button id="close-study-btn" style="margin-top:20px; padding:10px 20px; font-size:1.1em; cursor:pointer;">Return to Game</button>
            </div>
        `,document.getElementById("close-study-btn")?.addEventListener("click",()=>{this.container?.remove(),this.container=null,this.isOpen=!1}))}}class be{constructor(e){this.container=null,this.isOpen=!1,this.study=e}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen||(this.isOpen=!0,this.render())}close(){this.container&&(this.container.remove(),this.container=null),this.isOpen=!1}render(){this.container=document.createElement("div"),Object.assign(this.container.style,{position:"fixed",top:"10px",right:"10px",bottom:"10px",width:"400px",backgroundColor:"#1a1a1a",border:"1px solid #444",borderRadius:"8px",boxShadow:"-2px 0 10px rgba(0,0,0,0.5)",zIndex:"20000",display:"flex",flexDirection:"column",color:"#eee",fontFamily:"sans-serif"});const e=document.createElement("div");Object.assign(e.style,{padding:"15px",background:"#2d2d2d",borderBottom:"1px solid #444",display:"flex",justifyContent:"space-between",alignItems:"center"}),e.innerHTML="<strong>Moderator Dashboard</strong>";const t=document.createElement("button");t.innerText="‚úï",t.onclick=()=>this.close(),e.appendChild(t),this.container.appendChild(e);const n=document.createElement("div");Object.assign(n.style,{flex:"1",overflowY:"auto",padding:"15px"}),this.renderQuestionList(n),this.container.appendChild(n);const a=document.createElement("div");Object.assign(a.style,{padding:"15px",borderTop:"1px solid #444"});const o=document.createElement("button");o.innerText="+ Add Question",Object.assign(o.style,{width:"100%",padding:"8px",cursor:"pointer",backgroundColor:"#4dabf7",border:"none",borderRadius:"4px",color:"white"}),o.onclick=()=>{const c={id:`manual_${Date.now()}`,text:"New Question",type:"open"};this.study.addQuestion(c),this.renderQuestionList(n)},a.appendChild(o),this.container.appendChild(a),document.body.appendChild(this.container)}renderQuestionList(e){e.innerHTML="",this.study.getQuestions().forEach((n,a)=>{const o=document.createElement("div");Object.assign(o.style,{background:"#333",marginBottom:"10px",padding:"10px",borderRadius:"4px",border:"1px solid #555"});const c=document.createElement("div");c.style.display="flex",c.style.justifyContent="space-between",c.style.marginBottom="5px";const d=document.createElement("span");d.innerText=n.type.toUpperCase(),d.style.fontSize="0.7em",d.style.background="#000",d.style.padding="2px 5px",d.style.borderRadius="3px";const p=document.createElement("div"),m=document.createElement("button");m.innerText="‚úé",m.style.marginRight="5px",m.onclick=()=>this.editQuestion(n,o);const v=document.createElement("button");v.innerText="üóë",v.style.color="red",v.onclick=()=>{confirm("Delete this question?")&&(this.study.deleteQuestion(n.id),this.renderQuestionList(e))},p.appendChild(m),p.appendChild(v),c.appendChild(d),c.appendChild(p);const b=document.createElement("div");b.innerText=`${a+1}. ${n.text}`,o.appendChild(c),o.appendChild(b),e.appendChild(o)})}editQuestion(e,t){t.innerHTML="";const n=document.createElement("input");n.value=e.text,Object.assign(n.style,{width:"100%",padding:"5px",marginBottom:"5px"});const a=document.createElement("select");["open","binary","rating"].forEach(c=>{const d=document.createElement("option");d.value=c,d.text=c,c===e.type&&(d.selected=!0),a.appendChild(d)});const o=document.createElement("button");o.innerText="Save",o.onclick=()=>{this.study.updateQuestion(e.id,{text:n.value,type:a.value});const c=t.parentElement;c&&this.renderQuestionList(c)},t.appendChild(n),t.appendChild(a),t.appendChild(o)}}if(typeof document<"u"){const f=document.getElementById("status-bar");f&&(f.innerText="Initializing scripts..."),window.onerror=(e,t,n,a,o)=>(f&&(f.innerText=`CRITICAL ERROR: ${e}
Line: ${n}`,f.style.color="red"),!1)}const xe=async()=>{const f=document.getElementById("status-bar"),e=y=>{console.log(y),f&&(f.innerText=y)};e("Step 1: Imports loaded. Initializing Context..."),await new Promise(y=>setTimeout(y,100));const t=new ue({userId:"t2_browser_user",bucketId:"treatment"});e("Step 2: Context ready. Initializing SignalIntegrity..."),await new Promise(y=>setTimeout(y,100));const n=new D;new(await Q(async()=>{const{SessionTracker:y}=await Promise.resolve().then(()=>fe);return{SessionTracker:y}},void 0)).SessionTracker(n,"t2_browser_user"),e("Step 3: App components initializing..."),await new Promise(y=>setTimeout(y,100));const a=new ye(t),o=new he(n,t),c=new ge(t.config),d=new ve,p=new be(d);let m=0;e("Step 4: Rendering UI...");const v=document.getElementById("config-menu-container");if(v){v.innerHTML="<h3>Vibe Coding Menu</h3>"+c.renderData(t.config);const y=document.createElement("button");y.innerText="üïµÔ∏è Moderator Panel",Object.assign(y.style,{marginTop:"10px",width:"100%",padding:"5px",background:"#333",color:"#888",border:"1px solid #555",cursor:"pointer"}),y.onclick=()=>p.toggle(),v.appendChild(y)}o.mount(),setInterval(()=>o.render(),1e3);const b=document.getElementById("game-container"),w=document.getElementById("status-bar");if(!b)return;const x=10;b.style.gridTemplateColumns=`repeat(${x}, 1fr)`;const C=async()=>{const y=await a.getBoard();b.innerHTML="",y.forEach((M,L)=>{M.forEach((s,i)=>{const r=document.createElement("div");r.className="pixel",r.style.backgroundColor=s,r.title=`(${i}, ${L})`,r.onclick=async()=>{try{const l=t.config.Visuals?.Animations?.placePixelDuration||300;r.style.transition=`transform ${l}ms`,r.style.transform="scale(0.5)",await a.setPixel(i,L,t.config.Visuals?.Colors?.primary||"#FF4500"),n.capture("pixel_place","t2_browser_user",{x:i,y:L}),m++,m===3&&R();const u=Date.now();window.lastClickTimes||(window.lastClickTimes=[]),window.lastClickTimes.push(u),window.lastClickTimes=window.lastClickTimes.filter(g=>u-g<1e3),setTimeout(()=>r.style.transform="scale(1)",100)}catch(l){console.error(l)}},b.appendChild(r)})})};t.realtime.connect().subscribe("board_update",y=>{C()}),await C(),w&&(w.innerText="Connected. Place 3 pixels to unlock survey!");const E=document.createElement("button");E.innerText="Buy Premium Palette",E.style.marginTop="20px",E.style.padding="10px 20px",E.onclick=async()=>{new me(t,n,"custom_avatar_rare").render()},document.body.appendChild(E);const R=()=>{const y=document.createElement("button");y.innerText="üìã Take Research Survey",Object.assign(y.style,{display:"block",marginTop:"10px",padding:"10px 20px",backgroundColor:"#009688",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"1em"}),y.onclick=()=>d.start(),E.insertAdjacentElement("afterend",y)}};xe().catch(f=>{console.error(f);const e=document.getElementById("status-bar");e&&(e.innerText=`Error: ${f.message}`,e.style.color="red")});
