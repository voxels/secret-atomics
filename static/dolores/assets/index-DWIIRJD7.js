(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();const N="modulepreload",Q=function(h){return"/dolores/"+h},$={},A=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let f=function(g){return Promise.all(g.map(b=>Promise.resolve(b).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};var c=f;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),u=a?.nonce||a?.getAttribute("nonce");r=f(t.map(g=>{if(g=Q(g),g in $)return;$[g]=!0;const b=g.endsWith(".css"),w=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${w}`))return;const x=document.createElement("link");if(x.rel=b?"stylesheet":N,b||(x.as="script"),x.crossOrigin="",x.href=g,u&&x.setAttribute("nonce",u),document.head.appendChild(x),b)return new Promise((_,v)=>{x.addEventListener("load",_),x.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${g}`)))})}))}function i(a){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=a,window.dispatchEvent(u),!u.defaultPrevented)throw a}return r.then(a=>{for(const u of a||[])u.status==="rejected"&&i(u.reason);return e().catch(i)})};function M(){throw new Error("Buffer is not included.")}M.isBuffer=function(){return!1};var F=50;const G=Object.freeze(Object.defineProperty({__proto__:null,Buffer:M,INSPECT_MAX_BYTES:F,SlowBuffer:M},Symbol.toStringTag,{value:"Module"})),U={};function C(){}function H(){for(var h=arguments.length,e=new Array(h),t=0;t<h;t++)e[t]=arguments[t];var n=e[0];e.shift(),setTimeout(function(){typeof n=="function"&&n.apply(null,e)},0)}function W(h){throw new Error("No such module. (Possibly not yet loaded)")}var V={},O="browser",K=1,Y=!0,J={},X=[],B="/";function Z(){return B}function ee(h){B=U.resolve(h,B)}const te=Object.freeze(Object.defineProperty({__proto__:null,arch:O,argv:X,binding:W,browser:Y,chdir:ee,cwd:Z,dlopen:C,env:J,execPath:O,exit:C,features:V,kill:C,memoryUsage:C,nextTick:H,pid:K,platform:O,title:O,umask:C,uptime:C,uvCounters:C},Symbol.toStringTag,{value:"Module"}));globalThis.Buffer=M||void 0||G;globalThis.process=te;class ne{products=new Map;constructor(e=[]){e.forEach(t=>this.products.set(t.id,t))}getProducts(){return Array.from(this.products.values())}getProduct(e){return this.products.get(e)}purchase(e){const t=this.products.get(e);return t?t.sold_out||t.stock<=0?{success:!1,reason:"Sold out"}:(t.stock-=1,t.stock===0&&(t.sold_out=!0),{success:!0}):{success:!1,reason:"Product not found"}}updateStock(e,t){const n=this.products.get(e);n&&(n.stock=t,n.sold_out=t<=0)}}var R={exports:{}},D;function ie(){if(D)return R.exports;D=1;var h=typeof Reflect=="object"?Reflect:null,e=h&&typeof h.apply=="function"?h.apply:function(o,d,l){return Function.prototype.apply.call(o,d,l)},t;h&&typeof h.ownKeys=="function"?t=h.ownKeys:Object.getOwnPropertySymbols?t=function(o){return Object.getOwnPropertyNames(o).concat(Object.getOwnPropertySymbols(o))}:t=function(o){return Object.getOwnPropertyNames(o)};function n(s){console&&console.warn&&console.warn(s)}var r=Number.isNaN||function(o){return o!==o};function i(){i.init.call(this)}R.exports=i,R.exports.once=I,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var c=10;function a(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(s){if(typeof s!="number"||s<0||r(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");c=s}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(o){if(typeof o!="number"||o<0||r(o))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+o+".");return this._maxListeners=o,this};function u(s){return s._maxListeners===void 0?i.defaultMaxListeners:s._maxListeners}i.prototype.getMaxListeners=function(){return u(this)},i.prototype.emit=function(o){for(var d=[],l=1;l<arguments.length;l++)d.push(arguments[l]);var p=o==="error",y=this._events;if(y!==void 0)p=p&&y.error===void 0;else if(!p)return!1;if(p){var m;if(d.length>0&&(m=d[0]),m instanceof Error)throw m;var E=new Error("Unhandled error."+(m?" ("+m.message+")":""));throw E.context=m,E}var T=y[o];if(T===void 0)return!1;if(typeof T=="function")e(T,this,d);else for(var j=T.length,q=_(T,j),l=0;l<j;++l)e(q[l],this,d);return!0};function f(s,o,d,l){var p,y,m;if(a(d),y=s._events,y===void 0?(y=s._events=Object.create(null),s._eventsCount=0):(y.newListener!==void 0&&(s.emit("newListener",o,d.listener?d.listener:d),y=s._events),m=y[o]),m===void 0)m=y[o]=d,++s._eventsCount;else if(typeof m=="function"?m=y[o]=l?[d,m]:[m,d]:l?m.unshift(d):m.push(d),p=u(s),p>0&&m.length>p&&!m.warned){m.warned=!0;var E=new Error("Possible EventEmitter memory leak detected. "+m.length+" "+String(o)+" listeners added. Use emitter.setMaxListeners() to increase limit");E.name="MaxListenersExceededWarning",E.emitter=s,E.type=o,E.count=m.length,n(E)}return s}i.prototype.addListener=function(o,d){return f(this,o,d,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(o,d){return f(this,o,d,!0)};function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function b(s,o,d){var l={fired:!1,wrapFn:void 0,target:s,type:o,listener:d},p=g.bind(l);return p.listener=d,l.wrapFn=p,p}i.prototype.once=function(o,d){return a(d),this.on(o,b(this,o,d)),this},i.prototype.prependOnceListener=function(o,d){return a(d),this.prependListener(o,b(this,o,d)),this},i.prototype.removeListener=function(o,d){var l,p,y,m,E;if(a(d),p=this._events,p===void 0)return this;if(l=p[o],l===void 0)return this;if(l===d||l.listener===d)--this._eventsCount===0?this._events=Object.create(null):(delete p[o],p.removeListener&&this.emit("removeListener",o,l.listener||d));else if(typeof l!="function"){for(y=-1,m=l.length-1;m>=0;m--)if(l[m]===d||l[m].listener===d){E=l[m].listener,y=m;break}if(y<0)return this;y===0?l.shift():v(l,y),l.length===1&&(p[o]=l[0]),p.removeListener!==void 0&&this.emit("removeListener",o,E||d)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(o){var d,l,p;if(l=this._events,l===void 0)return this;if(l.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):l[o]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete l[o]),this;if(arguments.length===0){var y=Object.keys(l),m;for(p=0;p<y.length;++p)m=y[p],m!=="removeListener"&&this.removeAllListeners(m);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(d=l[o],typeof d=="function")this.removeListener(o,d);else if(d!==void 0)for(p=d.length-1;p>=0;p--)this.removeListener(o,d[p]);return this};function w(s,o,d){var l=s._events;if(l===void 0)return[];var p=l[o];return p===void 0?[]:typeof p=="function"?d?[p.listener||p]:[p]:d?L(p):_(p,p.length)}i.prototype.listeners=function(o){return w(this,o,!0)},i.prototype.rawListeners=function(o){return w(this,o,!1)},i.listenerCount=function(s,o){return typeof s.listenerCount=="function"?s.listenerCount(o):x.call(s,o)},i.prototype.listenerCount=x;function x(s){var o=this._events;if(o!==void 0){var d=o[s];if(typeof d=="function")return 1;if(d!==void 0)return d.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function _(s,o){for(var d=new Array(o),l=0;l<o;++l)d[l]=s[l];return d}function v(s,o){for(;o+1<s.length;o++)s[o]=s[o+1];s.pop()}function L(s){for(var o=new Array(s.length),d=0;d<o.length;++d)o[d]=s[d].listener||s[d];return o}function I(s,o){return new Promise(function(d,l){function p(m){s.removeListener(o,y),l(m)}function y(){typeof s.removeListener=="function"&&s.removeListener("error",p),d([].slice.call(arguments))}S(s,o,y,{once:!0}),o!=="error"&&P(s,p,{once:!0})})}function P(s,o,d){typeof s.on=="function"&&S(s,"error",o,d)}function S(s,o,d,l){if(typeof s.on=="function")l.once?s.once(o,d):s.on(o,d);else if(typeof s.addEventListener=="function")s.addEventListener(o,function p(y){l.once&&s.removeEventListener(o,p),d(y)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}return R.exports}var oe=ie();class se{emitter;channelHandlers=new Map;constructor(){this.emitter=new oe.EventEmitter}subscribe(e,t){this.channelHandlers.has(e)||this.channelHandlers.set(e,new Set),this.channelHandlers.get(e).add(t),this.emitter.on(e,t),console.log(`[RealtimeMock] Subscribed to ${e}`)}publish(e,t){const n=Math.floor(Math.random()*50);setTimeout(()=>{this.emitter.emit(e,t),console.log(`[RealtimeMock] Published to ${e} with ${n}ms latency`,t)},n)}unsubscribe(e,t){const n=this.channelHandlers.get(e);n&&(n.delete(t),this.emitter.off(e,t))}send(e,t){return this.publish(e,t)}connect(){return console.log("[RealtimeMock] Connected (Simulated)"),this}}const re=[{id:"gold_100",name:"100 Reddit Gold",price_gold:100,stock:999,sold_out:!1},{id:"gold_500",name:"500 Reddit Gold",price_gold:450,stock:100,sold_out:!1},{id:"custom_avatar_rare",name:"Ultra Rare Avatar",price_gold:500,stock:5,sold_out:!1}],ae={Timers:{cooldownMs:5e3,respawnMs:3e3},Limits:{maxDailyPixels:100,maxStackSize:5}},ce={Animations:{placePixelDuration:300,overlayFadeIn:150,easing:"cubic-bezier(0.4, 0, 0.2, 1)"},Colors:{primary:"#FF4500",secondary:"#0079D3",error:"#FF0000",success:"#00BA7C",canvasBackground:"#FFFFFF"}},de={Onboarding:{welcomeTitle:"Welcome to Pixel Placer",welcomeBody:"Place pixels and create art together!"},Errors:{cooldown:"You are doing that too much. Take a break!",soldOut:"Sorry, we are all out of pixels."},Buttons:{place:"Place Pixel",buy:"Get More"}},le={Gameplay:ae,Visuals:ce,Copy:de};class ue{userId;subredditId;bucketId;reddit;redis;realtime;kv;media;ui;config;_state;economy;constructor(e={}){this.userId=e.userId||"t2_user123",this.subredditId=e.subredditId||"t5_sub456",this.bucketId=e.bucketId||(Math.random()>.5?"treatment":"control"),this.config=le,this.economy=new ne(e.initialProducts||re),this.reddit=this._mockReddit(),this.redis=this._mockRedis(),this.realtime=new se,this.kv=this._mockKV(),this.media=this._mockMedia(),this._state=new Map,this.ui=this._mockUI()}getBucket(){return this.bucketId}useState(e){const t=JSON.stringify(e);return this._state.has(t)||this._state.set(t,e),[this._state.get(t),n=>{const r=this._state.get(t),i=typeof n=="function"?n(r):n;this._state.set(t,i)}]}_mockReddit(){return{getCurrentUser:async()=>({id:this.userId,name:"dummy_user"}),getSubredditById:async e=>({id:e,name:"test_sub"}),getCurrentSubreddit:async()=>({id:this.subredditId,name:"test_sub"}),getProducts:async()=>this.economy.getProducts(),pay:async e=>{const t=this.economy.getProduct(e.productId),n=this.economy.purchase(e.productId);return console.log(`[MockEconomy] Triggering Modal for ${t?.name||e.productId}`),n.success?{status:"success"}:{status:"failed",reason:n.reason}}}}_mockRedis(){const e=new Map,t=typeof process<"u"&&process.versions!=null&&process.versions.node!=null,n=".dolores_redis_dump.json",r="dolores_redis_dump";if(t)try{const c=require("fs");if(c.existsSync(n)){const a=JSON.parse(c.readFileSync(n,"utf-8"));Object.entries(a).forEach(([u,f])=>e.set(u,f)),console.log("[MockRedis] Loaded persistent state from disk.")}}catch(c){console.warn("[MockRedis] Failed to load persistent state:",c)}else if(typeof localStorage<"u")try{const c=localStorage.getItem(r);if(c){const a=JSON.parse(c);Object.entries(a).forEach(([u,f])=>e.set(u,f)),console.log("[MockRedis] Loaded persistent state from localStorage.")}}catch(c){console.warn("[MockRedis] Failed to load localStorage:",c)}const i=()=>{const c=Object.fromEntries(e),a=JSON.stringify(c,null,2);if(t)try{require("fs").writeFileSync(n,a)}catch(u){console.error("[MockRedis] Persistence failed:",u)}else typeof localStorage<"u"&&localStorage.setItem(r,a)};return{get:async c=>e.get(c),set:async(c,a)=>{e.set(c,a),i()},del:async c=>{e.delete(c),i()},hGet:async(c,a)=>(e.get(c)||{})[a],hSet:async(c,a,u)=>{const f=e.get(c)||{};f[a]=u,e.set(c,f),i()}}}_mockKV(){const e=new Map;return{get:async t=>e.get(t),put:async(t,n)=>{e.set(t,n)},delete:async t=>{e.delete(t)},list:async()=>Array.from(e.keys())}}_mockMedia(){return{upload:async e=>({id:`media_${Math.random().toString(36).substr(2,9)}`,url:e}),getMediaById:async e=>({id:e,url:`https://mock.reddit.com/${e}.jpg`})}}_mockUI(){return{showToast:e=>{console.log(`[MockUI] Toast: ${typeof e=="string"?e:e.text}`)},navigateTo:e=>{console.log(`[MockUI] Navigating to: ${e}`)},showForm:e=>(console.log(`[MockUI] Showing form: ${e}`),Promise.resolve({values:{}}))}}}class pe{si;userId;startTime;totalActiveTime=0;lastVisibleStart;constructor(e,t="anon"){this.si=e,this.userId=t,this.startTime=Date.now(),this.lastVisibleStart=Date.now(),typeof document<"u"&&this.attach()}attach(){document.addEventListener("visibilitychange",()=>{if(document.hidden){const e=Date.now()-this.lastVisibleStart;this.totalActiveTime+=e,this.si.capture("session_visibility_hidden",this.userId,{active_segment_ms:e,total_active_ms:this.totalActiveTime})}else this.lastVisibleStart=Date.now(),this.si.capture("session_visibility_visible",this.userId,{})}),window.addEventListener("beforeunload",()=>{const e=Date.now()-this.lastVisibleStart;document.hidden||(this.totalActiveTime+=e),this.si.capture("session_end",this.userId,{total_duration_ms:Date.now()-this.startTime,total_active_ms:this.totalActiveTime})})}}class z{events=[];capture(e,t,n={}){const r={event_type:e,user_id:t,timestamp:Date.now(),payload:n};return this.events.push(r),console.log(`[SignalIntegrity] Captured ${e} for ${t}`,n),r}detectRageClicks(e,t=3,n=1e3){return e.length<t?!1:e.filter(i=>Date.now()-i<n).length>=t}simulateThetaSketch(e){const n=new Set(e).size;return{estimate:n,lowerBound:Math.floor(n*.98),upperBound:Math.ceil(n*1.02)}}getEvents(){return[...this.events]}clear(){this.events=[]}}const he=Object.freeze(Object.defineProperty({__proto__:null,SessionTracker:pe,SignalIntegrity:z},Symbol.toStringTag,{value:"Module"}));class fe{context;si;productId;container=null;constructor(e,t,n="gold_100"){this.context=e,this.si=t,this.productId=n}async render(e=null){if(typeof document>"u"){console.log(`[GoldGate] Virtual Render: Discovered Product ${this.productId}`);return}const t=e||document.body,n=this.context.getBucket(),i=(await this.context.reddit.getProducts()).find(a=>a.id===this.productId);if(!i){console.error(`[GoldGate] Product ${this.productId} not found`);return}const c=n==="treatment"?Math.floor(i.price_gold*.8):i.price_gold;this.container=document.createElement("div"),this.container.id="gold-gate-container",this.applyStyles(),this.container.innerHTML=`
      <div style="background: #1a1a1b; color: #d7dadc; padding: 20px; border-radius: 8px; border: 1px solid #343536; text-align: center; width: 350px;">
        <h3 style="margin-top: 0; color: #ffd700;">Exclusive Offer</h3>
        <p style="font-size: 14px;">Get <strong>${i.name}</strong> to unlock premium features.</p>
        <div style="margin: 20px 0;">
          <span style="font-size: 24px; font-weight: bold; color: ${n==="treatment"?"#44ff44":"#ffffff"}">
            ${c} Gold
          </span>
          ${n==="treatment"?`<br/><small style="text-decoration: line-through; opacity: 0.6;">${i.price_gold} Gold</small>`:""}
        </div>
        <button id="gold-gate-buy-btn" style="background: #ff4500; color: white; border: none; padding: 12px 24px; border-radius: 999px; cursor: pointer; font-weight: bold; width: 100%;">
          Purchase Now
        </button>
        <p style="font-size: 10px; margin-top: 10px; opacity: 0.5;">Experiment Bucket: ${n}</p>
      </div>
    `,t.appendChild(this.container),document.getElementById("gold-gate-buy-btn")?.addEventListener("click",async()=>{this.si.capture("gold_gate_click","user_id",{bucket:n,price:c});const a=await this.context.reddit.pay({productId:this.productId});a.status==="success"?(this.si.capture("gold_gate_purchase_success","user_id",{bucket:n}),alert("Purchase successful!")):(this.si.capture("gold_gate_purchase_failed","user_id",{bucket:n,reason:a.reason}),alert(`Purchase failed: ${a.reason}`))}),this.si.capture("gold_gate_impression","user_id",{bucket:n,price:c})}applyStyles(){this.container&&Object.assign(this.container.style,{position:"fixed",bottom:"100px",right:"20px",zIndex:"9999",fontFamily:"sans-serif"})}}class me{config;container=null;constructor(e){this.config=e}renderData(e,t=0){if(typeof document>"u")return"";let n=`<ul style="list-style: none; padding-left: ${t*15}px;">`;for(const r in e){const i=e[r],c=typeof i=="object"&&i!==null;n+='<li style="margin-bottom: 5px;">',c?(n+=`<div style="font-weight: bold; cursor: pointer;">‚ñ∂ ${r}</div>`,n+=this.renderData(i,t+1)):n+=`
          <div style="display: flex; justify-content: space-between; width: 200px;">
            <span style="opacity: 0.8;">${r}:</span>
            <input type="text" value="${i}" style="width: 80px; background: #333; color: white; border: none;" />
          </div>
        `,n+="</li>"}return n+="</ul>",n}renderCLI(e=this.config,t=""){let n="";const r=Object.entries(e);return r.forEach(([i,c],a)=>{const u=a===r.length-1,f=u?"‚îî‚îÄ‚îÄ ":"‚îú‚îÄ‚îÄ ",g=t+(u?"    ":"‚îÇ   ");typeof c=="object"&&c!==null?(n+=`${t}${f}${i}
`,n+=this.renderCLI(c,g)):n+=`${t}${f}${i}: ${c}
`}),n}}class ge{constructor(e){this.width=10,this.height=10,this.context=e}async setPixel(e,t,n){if(e<0||e>=this.width||t<0||t>=this.height)throw new Error("Coordinates out of bounds");const r=`pixel:${e}:${t}`;await this.context.redis.set(r,n),this.context.realtime.send("board_update",{x:e,y:t,color:n}),console.log(`[PixelBoard] Set pixel (${e}, ${t}) to ${n}`)}async getBoard(){const e=Array(this.height).fill(null).map(()=>Array(this.width).fill("#ffffff"));for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++){const r=await this.context.redis.get(`pixel:${n}:${t}`);r&&(e[t][n]=r)}return e}}class k{constructor(){}static getInstance(){return k.instance||(k.instance=new k),k.instance}async analyzeResponse(e,t){if(await new Promise(i=>setTimeout(i,800)),t.split(" ").length<5)return null;const n=t.toLowerCase();if(n.includes("color")||n.includes("palette")||n.includes("red")||n.includes("blue"))return"Interesting choice of colors. Did you find the current palette sufficient for your expression?";if(n.includes("grid")||n.includes("size")||n.includes("small")||n.includes("big"))return"How would a different grid size change your strategy?";if(n.includes("click")||n.includes("place")||n.includes("mouse")||n.includes("tap"))return"Did the interaction feel responsive enough during rapid placement?";if(n.includes("feature")||n.includes("add")||n.includes("wish"))return"If we added that feature, what is the first thing you would build with it?";const r=["Can you elaborate a bit more on that?","That's a unique perspective. Why do you feel that way?","How did that impact your overall decision making?"];return r[Math.floor(Math.random()*r.length)]}async generateRageClickIntervention(){await new Promise(t=>setTimeout(t,300));const e=["It seems like you're clicking quite rapidly. Is the interface not responding as you expect?","I noticed some rapid interaction. Are you experiencing any frustration with the pixel placement?","Whoa, those were some fast clicks! Did something unexpected happen with the board?","Is everything working okay? I detected some intense clicking just now."];return e[Math.floor(Math.random()*e.length)]}}const ye=Object.freeze(Object.defineProperty({__proto__:null,GeminiModerator:k},Symbol.toStringTag,{value:"Module"}));class ve{constructor(){this.questions=[],this.currentIndex=0,this.container=null,this.isOpen=!1,this.moderator=k.getInstance(),this.seedQuestions()}seedQuestions(){this.questions=[{id:"q1",text:"How would you rate your experience placing pixels?",type:"rating"},{id:"q2",text:"Did you find the 'Buy Premium' option intrusive?",type:"binary"},{id:"q3",text:"What motivated you to choose the colors you used?",type:"open"},{id:"q4",text:"How likely are you to recommend this to a friend?",type:"rating"},{id:"q5",text:"If you could add one feature, what would it be?",type:"open"},{id:"q6",text:"Do you prefer the current grid size?",type:"binary"},{id:"q7",text:"Rate the responsiveness of the interface.",type:"rating"},{id:"q8",text:"Any final thoughts?",type:"open"}]}getQuestions(){return[...this.questions]}addQuestion(e){this.questions.push(e)}updateQuestion(e,t){const n=this.questions.findIndex(r=>r.id===e);n!==-1&&(this.questions[n]={...this.questions[n],...t})}deleteQuestion(e){this.questions=this.questions.filter(t=>t.id!==e)}start(){this.isOpen||(this.isOpen=!0,this.currentIndex=0,this.renderOverlay(),this.showQuestion())}renderOverlay(){this.container=document.createElement("div"),this.container.id="qualitative-study-overlay",Object.assign(this.container.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.85)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"10000",color:"white"}),document.body.appendChild(this.container)}async showQuestion(){if(!this.container)return;if(this.container.innerHTML="",this.currentIndex>=this.questions.length){this.showCompletion();return}const e=this.questions[this.currentIndex],t=document.createElement("div");Object.assign(t.style,{backgroundColor:"#222",padding:"30px",borderRadius:"12px",maxWidth:"500px",width:"90%",textAlign:"center",border:"1px solid #444"});const n=e.id.startsWith("follow_up"),r=document.createElement("h3");r.innerText=n?"Gemini Follow-up":`Question ${this.currentIndex+1}/${this.questions.length}`,n&&(r.style.color="#4dabf7");const i=document.createElement("p");i.innerText=e.text,i.style.fontSize="1.2em",i.style.margin="20px 0",t.appendChild(r),t.appendChild(i);const c=document.createElement("div");if(e.type==="rating"){const a=document.createElement("div");a.style.fontSize="2em",a.style.cursor="pointer",[1,2,3,4,5].forEach(u=>{const f=document.createElement("span");f.innerText="‚òÖ",f.style.color="#444",f.style.margin="0 5px",f.onclick=()=>{Array.from(a.children).forEach((g,b)=>{g.style.color=b<u?"gold":"#444"}),setTimeout(()=>this.nextQuestion(u.toString()),400)},a.appendChild(f)}),c.appendChild(a)}else if(e.type==="binary")["Yes","No"].forEach(a=>{const u=document.createElement("button");u.innerText=a,Object.assign(u.style,{margin:"10px",padding:"10px 30px",fontSize:"1em",cursor:"pointer",background:"#333",color:"white",border:"1px solid #666",borderRadius:"5px"}),u.onclick=()=>this.nextQuestion(a),c.appendChild(u)});else if(e.type==="open"){const a=document.createElement("textarea");Object.assign(a.style,{width:"100%",height:"100px",background:"#111",color:"white",border:"1px solid #555",padding:"10px",fontSize:"1em",borderRadius:"5px",marginBottom:"15px"}),c.appendChild(a);const u=document.createElement("button");u.innerText="Submit Answer",Object.assign(u.style,{padding:"10px 20px",background:"#d93025",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}),u.onclick=()=>{a.value.trim().length>0&&this.nextQuestion(a.value)},c.appendChild(u)}t.appendChild(c),this.container.appendChild(t)}async nextQuestion(e){const t=this.questions[this.currentIndex];if(t.type==="open"&&!t.id.startsWith("follow_up")){this.container.innerHTML+='<p style="color:#aaa; margin-top:20px;">Gemini is analyzing your response...</p>';const n=await this.moderator.analyzeResponse(t.text,e);if(n){const r={id:`follow_up_${Date.now()}`,text:n,type:"open"};this.questions.splice(this.currentIndex+1,0,r)}}this.currentIndex++,this.showQuestion()}async triggerIntervention(e){if(this.isOpen)return;this.isOpen=!0;const t={id:`intervention_${Date.now()}`,text:e,type:"open"};this.renderOverlay(),this.showInterventionQuestion(t)}showInterventionQuestion(e){if(!this.container)return;this.container.innerHTML="";const t=document.createElement("div");Object.assign(t.style,{backgroundColor:"#222",padding:"30px",borderRadius:"12px",maxWidth:"500px",width:"90%",textAlign:"center",border:"2px solid #d93025"});const n=document.createElement("h3");n.innerText="Gemini Observation",n.style.color="#ff6b6b";const r=document.createElement("p");r.innerText=e.text,r.style.fontSize="1.2em",r.style.margin="20px 0",t.appendChild(n),t.appendChild(r);const i=document.createElement("div"),c=document.createElement("textarea");Object.assign(c.style,{width:"100%",height:"80px",background:"#111",color:"white",border:"1px solid #555",padding:"10px",fontSize:"1em",borderRadius:"5px",marginBottom:"15px"}),i.appendChild(c);const a=document.createElement("button");a.innerText="Send Feedback",Object.assign(a.style,{padding:"10px 20px",background:"#d93025",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}),a.onclick=()=>{this.container?.remove(),this.container=null,this.isOpen=!1},i.appendChild(a),t.appendChild(i),this.container.appendChild(t)}showCompletion(){this.container&&(this.container.innerHTML=`
            <div style="text-align:center; background:#222; padding:40px; border-radius:12px; max-width:500px; width:90%;">
                <h2 style="color:gold;">Study Complete!</h2>
                <p>Thank you for participating in our qualitative research.</p>
                <div style="font-size:3em; margin:20px;">üéÅ</div>
                <p>You've earned the <strong>Research Contributor</strong> badge.</p>
                <button id="close-study-btn" style="margin-top:20px; padding:10px 20px; font-size:1.1em; cursor:pointer;">Return to Game</button>
            </div>
        `,document.getElementById("close-study-btn")?.addEventListener("click",()=>{this.container?.remove(),this.container=null,this.isOpen=!1}))}}class xe{constructor(e){this.container=null,this.isOpen=!1,this.study=e}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen||(this.isOpen=!0,this.render())}close(){this.container&&(this.container.remove(),this.container=null),this.isOpen=!1}render(){this.container=document.createElement("div"),Object.assign(this.container.style,{position:"fixed",top:"10px",right:"10px",bottom:"10px",width:"400px",backgroundColor:"#1a1a1a",border:"1px solid #444",borderRadius:"8px",boxShadow:"-2px 0 10px rgba(0,0,0,0.5)",zIndex:"20000",display:"flex",flexDirection:"column",color:"#eee",fontFamily:"sans-serif"});const e=document.createElement("div");Object.assign(e.style,{padding:"15px",background:"#2d2d2d",borderBottom:"1px solid #444",display:"flex",justifyContent:"space-between",alignItems:"center"}),e.innerHTML="<strong>Moderator Dashboard</strong>";const t=document.createElement("button");t.innerText="‚úï",t.onclick=()=>this.close(),e.appendChild(t),this.container.appendChild(e);const n=document.createElement("div");Object.assign(n.style,{flex:"1",overflowY:"auto",padding:"15px"}),this.renderQuestionList(n),this.container.appendChild(n);const r=document.createElement("div");Object.assign(r.style,{padding:"15px",borderTop:"1px solid #444"});const i=document.createElement("button");i.innerText="+ Add Question",Object.assign(i.style,{width:"100%",padding:"8px",cursor:"pointer",backgroundColor:"#4dabf7",border:"none",borderRadius:"4px",color:"white"}),i.onclick=()=>{const c={id:`manual_${Date.now()}`,text:"New Question",type:"open"};this.study.addQuestion(c),this.renderQuestionList(n)},r.appendChild(i),this.container.appendChild(r),document.body.appendChild(this.container)}renderQuestionList(e){e.innerHTML="",this.study.getQuestions().forEach((n,r)=>{const i=document.createElement("div");Object.assign(i.style,{background:"#333",marginBottom:"10px",padding:"10px",borderRadius:"4px",border:"1px solid #555"});const c=document.createElement("div");c.style.display="flex",c.style.justifyContent="space-between",c.style.marginBottom="5px";const a=document.createElement("span");a.innerText=n.type.toUpperCase(),a.style.fontSize="0.7em",a.style.background="#000",a.style.padding="2px 5px",a.style.borderRadius="3px";const u=document.createElement("div"),f=document.createElement("button");f.innerText="‚úé",f.style.marginRight="5px",f.onclick=()=>this.editQuestion(n,i);const g=document.createElement("button");g.innerText="üóë",g.style.color="red",g.onclick=()=>{confirm("Delete this question?")&&(this.study.deleteQuestion(n.id),this.renderQuestionList(e))},u.appendChild(f),u.appendChild(g),c.appendChild(a),c.appendChild(u);const b=document.createElement("div");b.innerText=`${r+1}. ${n.text}`,i.appendChild(c),i.appendChild(b),e.appendChild(i)})}editQuestion(e,t){t.innerHTML="";const n=document.createElement("input");n.value=e.text,Object.assign(n.style,{width:"100%",padding:"5px",marginBottom:"5px"});const r=document.createElement("select");["open","binary","rating"].forEach(c=>{const a=document.createElement("option");a.value=c,a.text=c,c===e.type&&(a.selected=!0),r.appendChild(a)});const i=document.createElement("button");i.innerText="Save",i.onclick=()=>{this.study.updateQuestion(e.id,{text:n.value,type:r.value});const c=t.parentElement;c&&this.renderQuestionList(c)},t.appendChild(n),t.appendChild(r),t.appendChild(i)}}class be{static async selectRole(){return new Promise(e=>{const t=document.createElement("div");Object.assign(t.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"#111",color:"white",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"100000",fontFamily:"sans-serif"});const n=document.createElement("h1");n.innerText="Select Your Role",n.style.marginBottom="40px",t.appendChild(n);const r=(c,a,u,f)=>{const g=document.createElement("div");Object.assign(g.style,{background:"#222",border:"1px solid #444",padding:"20px",margin:"10px",width:"300px",cursor:"pointer",borderRadius:"8px",textAlign:"left",transition:"background 0.2s",display:"flex",alignItems:"center"}),g.onmouseover=()=>g.style.background="#333",g.onmouseout=()=>g.style.background="#222",g.onclick=()=>{t.remove(),e(a)};const b=document.createElement("div");b.innerText=f,b.style.fontSize="2.5em",b.style.marginRight="20px";const w=document.createElement("div"),x=document.createElement("div");x.innerText=c,x.style.fontSize="1.2em",x.style.fontWeight="bold";const _=document.createElement("div");return _.innerText=u,_.style.color="#888",_.style.fontSize="0.9em",_.style.marginTop="5px",w.appendChild(x),w.appendChild(_),g.appendChild(b),g.appendChild(w),g};t.appendChild(r("Study Participant","participant","Play the game and take the survey. (Standard User)","üë§")),t.appendChild(r("Study Designer","designer","Construct and edit the qualitative study questions.","üõ†Ô∏è")),t.appendChild(r("Moderator","moderator","Monitor live activity and study results.","üìä")),document.body.appendChild(t);const i=document.getElementById("status-bar");i&&(i.style.zIndex="0")})}}class we{constructor(){this.container=null,this.logs=[],this.listContainer=null,this.render()}log(e){const t=new Date().toLocaleTimeString();this.logs.unshift(`[${t}] ${e}`),this.renderLogs()}render(){this.container=document.createElement("div"),Object.assign(this.container.style,{position:"absolute",top:"0",left:"0",width:"100vw",height:"100vh",backgroundColor:"#050505",color:"#00ff00",fontFamily:"monospace",padding:"20px",boxSizing:"border-box",overflow:"hidden",display:"flex",flexDirection:"column"});const e=document.createElement("h2");e.innerText="üìä Live Study Monitor",e.style.borderBottom="1px solid #333",e.style.paddingBottom="10px",e.style.marginBottom="20px",this.container.appendChild(e);const t=document.createElement("div");t.style.display="flex",t.style.gap="20px",t.style.marginBottom="20px";const n=(i,c)=>{const a=document.createElement("div");a.style.background="#111",a.style.padding="15px",a.style.minWidth="150px",a.style.border="1px solid #333";const u=document.createElement("div");u.innerText=i,u.style.color="#888";const f=document.createElement("div");return f.innerText=c,f.style.fontSize="2em",f.id=`stat-${i.replace(" ","-")}`,a.appendChild(u),a.appendChild(f),a};t.appendChild(n("Active Users","1")),t.appendChild(n("Survey Completes","0")),this.container.appendChild(t);const r=document.createElement("div");r.innerText="> Event Stream",r.style.color="#fff",r.style.marginBottom="10px",this.container.appendChild(r),this.listContainer=document.createElement("div"),Object.assign(this.listContainer.style,{flex:"1",overflowY:"auto",background:"#0a0a0a",border:"1px solid #333",padding:"10px",fontSize:"1.1em"}),this.container.appendChild(this.listContainer),document.body.appendChild(this.container),this.log("Session started. Listening for events...")}renderLogs(){this.listContainer&&(this.listContainer.innerHTML="",this.logs.forEach(e=>{const t=document.createElement("div");t.innerText=e,t.style.padding="5px 0",t.style.borderBottom="1px solid #111",this.listContainer.appendChild(t)}))}}if(typeof document<"u"){const h=document.getElementById("status-bar");h&&(h.innerText="Initializing scripts..."),window.onerror=(e,t,n,r,i)=>(h&&(h.innerText=`CRITICAL ERROR: ${e}
Line: ${n}`,h.style.color="red"),!1)}const _e=async()=>{const h=await be.selectRole();console.log(`Starting in role: ${h}`);const e=document.getElementById("status-bar"),t=v=>{console.log(v),e&&(e.innerText=v)};t("Step 1: Imports loaded. Initializing Context...");const n=new ue({userId:"t2_browser_user",bucketId:"treatment"});t("Step 2: Context ready. Initializing SignalIntegrity..."),await new Promise(v=>setTimeout(v,100));const r=new z;new(await A(async()=>{const{SessionTracker:v}=await Promise.resolve().then(()=>he);return{SessionTracker:v}},void 0)).SessionTracker(r,"t2_browser_user"),t("Step 3: App components initializing..."),await new Promise(v=>setTimeout(v,100));const i=new ve;if(h==="designer"){t("Initializing Designer Mode...");const v=document.getElementById("game-container");v&&(v.style.display="none"),new xe(i).open(),e&&(e.innerText="Designer Mode Active. Edit your study.");return}if(h==="moderator"){t("Initializing Moderator Mode...");const v=document.getElementById("game-container");v&&(v.style.display="none"),new we,e&&(e.style.display="none");return}const c=new ge(n);new me(n.config);let a=0;t("Step 4: Rendering UI (Participant)...");const u=document.getElementById("config-menu-container");u&&(u.style.display="none");const f=document.getElementById("game-container"),g=document.getElementById("status-bar");if(!f)return;const b=10;f.style.gridTemplateColumns=`repeat(${b}, 1fr)`;const w=async()=>{const v=await c.getBoard();f.innerHTML="",v.forEach((L,I)=>{L.forEach((P,S)=>{const s=document.createElement("div");s.className="pixel",s.style.backgroundColor=P,s.title=`(${S}, ${I})`,s.onclick=async()=>{try{const o=n.config.Visuals?.Animations?.placePixelDuration||300;s.style.transition=`transform ${o}ms`,s.style.transform="scale(0.5)",await c.setPixel(S,I,n.config.Visuals?.Colors?.primary||"#FF4500"),r.capture("pixel_place","t2_browser_user",{x:S,y:I}),a++,a===3&&_();const d=Date.now();if(window.lastClickTimes||(window.lastClickTimes=[]),window.lastClickTimes.push(d),window.lastClickTimes=window.lastClickTimes.filter(l=>d-l<1e3),window.lastClickTimes.length>=5){console.warn("[Rage Click] Intercepted!"),window.lastClickTimes=[];const p=await(await A(async()=>{const{GeminiModerator:y}=await Promise.resolve().then(()=>ye);return{GeminiModerator:y}},void 0)).GeminiModerator.getInstance().generateRageClickIntervention();i.triggerIntervention(p)}setTimeout(()=>s.style.transform="scale(1)",100)}catch(o){console.error(o)}},f.appendChild(s)})})};n.realtime.connect().subscribe("board_update",v=>{w()}),await w(),g&&(g.innerText="Connected. Place 3 pixels to unlock survey!");const x=document.createElement("button");x.innerText="Buy Premium Palette",x.style.marginTop="20px",x.style.padding="10px 20px",x.onclick=async()=>{new fe(n,r,"custom_avatar_rare").render()},document.body.appendChild(x);const _=()=>{const v=document.createElement("button");v.innerText="üìã Take Research Survey",Object.assign(v.style,{display:"block",marginTop:"10px",padding:"10px 20px",backgroundColor:"#009688",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"1em"}),v.onclick=()=>i.start(),x.insertAdjacentElement("afterend",v)}};_e().catch(h=>{console.error(h);const e=document.getElementById("status-bar");e&&(e.innerText=`Error: ${h.message}`,e.style.color="red")});
