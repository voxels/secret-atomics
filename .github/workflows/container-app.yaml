properties:
  configuration:
    ingress:
      external: true
      targetPort: 3000
      transport: auto
      allowInsecure: false
  template:
    scale:
      minReplicas: 1
      maxReplicas: 1
    containers:
    - name: ${CONTAINER_APP_NAME}
      image: ${IMAGE}
      resources:
        cpu: 0.5
        memory: 1.0Gi
      env:
      - name: NEXT_PUBLIC_BASE_URL
        value: "${NEXT_PUBLIC_BASE_URL}"
      - name: NEXT_PUBLIC_SANITY_PROJECT_ID
        value: "${NEXT_PUBLIC_SANITY_PROJECT_ID}"
      - name: NEXT_PUBLIC_SANITY_DATASET
        value: "${NEXT_PUBLIC_SANITY_DATASET}"
      - name: NEXT_PUBLIC_SANITY_BROWSER_TOKEN
        value: "${NEXT_PUBLIC_SANITY_BROWSER_TOKEN}"
      - name: NEXT_PUBLIC_UMAMI_SCRIPT_URL
        value: "${NEXT_PUBLIC_UMAMI_SCRIPT_URL}"
      - name: NEXT_PUBLIC_UMAMI_WEBSITE_ID
        value: "${NEXT_PUBLIC_UMAMI_WEBSITE_ID}"
      - name: NEXT_PUBLIC_APP_ENV
        value: "${NEXT_PUBLIC_APP_ENV}"
      - name: NEXT_PUBLIC_SENTRY_DSN
        value: "${NEXT_PUBLIC_SENTRY_DSN}"
      - name: SENTRY_ORG
        value: "${SENTRY_ORG}"
      - name: SENTRY_PROJECT
        value: "${SENTRY_PROJECT}"
      probes:
      - type: liveness
        httpGet:
          path: /api/health
          port: 3000
        initialDelaySeconds: 60
        periodSeconds: 30
        timeoutSeconds: 10
        failureThreshold: 3
      - type: readiness
        httpGet:
          path: /api/health
          port: 3000
        initialDelaySeconds: 10
        periodSeconds: 10
        timeoutSeconds: 5
        failureThreshold: 3
